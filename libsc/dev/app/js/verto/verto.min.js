var AdapterJS=AdapterJS||{};"undefined"!=typeof exports&&(module.exports=AdapterJS),AdapterJS.options=AdapterJS.options||{},AdapterJS.VERSION="0.13.3",AdapterJS.onwebrtcready=AdapterJS.onwebrtcready||function(a){},AdapterJS._onwebrtcreadies=[],AdapterJS.webRTCReady=function(a){if("function"!=typeof a)throw new Error("Callback provided is not a function");!0===AdapterJS.onwebrtcreadyDone?a(null!==AdapterJS.WebRTCPlugin.plugin):AdapterJS._onwebrtcreadies.push(a)},AdapterJS.WebRTCPlugin=AdapterJS.WebRTCPlugin||{},AdapterJS.WebRTCPlugin.pluginInfo={prefix:"Tem",plugName:"TemWebRTCPlugin",pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__TemWebRTCReady0",portalLink:"http://skylink.io/plugin/",downloadLink:null,companyName:"Snapcall"},navigator.platform.match(/^Mac/i)?AdapterJS.WebRTCPlugin.pluginInfo.downloadLink="http://bit.ly/1n77hco":navigator.platform.match(/^Win/i)&&(AdapterJS.WebRTCPlugin.pluginInfo.downloadLink="http://bit.ly/1kkS4FN"),AdapterJS.WebRTCPlugin.TAGS={NONE:"none",AUDIO:"audio",VIDEO:"video"},AdapterJS.WebRTCPlugin.pageId=Math.random().toString(36).slice(2),AdapterJS.WebRTCPlugin.plugin=null,AdapterJS.WebRTCPlugin.setLogLevel=null,AdapterJS.WebRTCPlugin.defineWebRTCInterface=null,AdapterJS.WebRTCPlugin.isPluginInstalled=null,AdapterJS.WebRTCPlugin.pluginInjectionInterval=null,AdapterJS.WebRTCPlugin.injectPlugin=null,AdapterJS.WebRTCPlugin.PLUGIN_STATES={NONE:0,INITIALIZING:1,INJECTING:2,INJECTED:3,READY:4},AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.NONE,AdapterJS.onwebrtcreadyDone=!1,AdapterJS.WebRTCPlugin.PLUGIN_LOG_LEVELS={NONE:"NONE",ERROR:"ERROR",WARNING:"WARNING",INFO:"INFO",VERBOSE:"VERBOSE",SENSITIVE:"SENSITIVE"},AdapterJS.WebRTCPlugin.WaitForPluginReady=null,AdapterJS.WebRTCPlugin.callWhenPluginReady=null,__TemWebRTCReady0=function(){if("complete"===document.readyState)AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY,AdapterJS.maybeThroughWebRTCReady();else var a=setInterval(function(){"complete"===document.readyState&&(clearInterval(a),AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY,AdapterJS.maybeThroughWebRTCReady())},100)},AdapterJS.maybeThroughWebRTCReady=function(){AdapterJS.onwebrtcreadyDone||(AdapterJS.onwebrtcreadyDone=!0,AdapterJS._onwebrtcreadies.length?AdapterJS._onwebrtcreadies.forEach(function(a){"function"==typeof a&&a(null!==AdapterJS.WebRTCPlugin.plugin)}):"function"==typeof AdapterJS.onwebrtcready&&AdapterJS.onwebrtcready(null!==AdapterJS.WebRTCPlugin.plugin))},AdapterJS.TEXT={PLUGIN:{REQUIRE_INSTALLATION:"This website requires you to install a WebRTC-enabling plugin to work on this browser.",NOT_SUPPORTED:"Your browser does not support WebRTC.",BUTTON:"Install Now"},REFRESH:{REQUIRE_REFRESH:"Please refresh page",BUTTON:"Refresh Page"}},AdapterJS._iceConnectionStates={starting:"starting",checking:"checking",connected:"connected",completed:"connected",done:"completed",disconnected:"disconnected",failed:"failed",closed:"closed"},AdapterJS._iceConnectionFiredStates=[],AdapterJS.isDefined=null,AdapterJS.parseWebrtcDetectedBrowser=function(){var a=null;window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0?(webrtcDetectedBrowser="opera",webrtcDetectedType="webkit",webrtcMinimumVersion=26,a=/OPR\/(\d+)/i.exec(navigator.userAgent)||[],webrtcDetectedVersion=parseInt(a[1],10)):"undefined"!=typeof InstallTrigger?webrtcDetectedType="moz":Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?(webrtcDetectedBrowser="safari",webrtcDetectedType="plugin",webrtcMinimumVersion=7,a=/version\/(\d+)/i.exec(navigator.userAgent)||[],webrtcDetectedVersion=parseInt(a[1],10)):document.documentMode?(webrtcDetectedBrowser="IE",webrtcDetectedType="plugin",webrtcMinimumVersion=9,a=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],webrtcDetectedVersion=parseInt(a[1]||"0",10),webrtcDetectedVersion||(a=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],webrtcDetectedVersion=parseInt(a[1]||"0",10))):window.StyleMedia?webrtcDetectedType="":window.chrome&&window.chrome.webstore?webrtcDetectedType="webkit":"chrome"!==webrtcDetectedBrowser&&"opera"!==webrtcDetectedBrowser||!window.CSS||(webrtcDetectedBrowser="blink"),window.webrtcDetectedBrowser=webrtcDetectedBrowser,window.webrtcDetectedVersion=webrtcDetectedVersion,window.webrtcMinimumVersion=webrtcMinimumVersion},AdapterJS.addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a[b]=c},AdapterJS.renderNotificationBar=function(a,b,c,d,e){if("complete"===document.readyState){var f=window,g=document.createElement("iframe");g.name="adapterjs-alert",g.style.position="fixed",g.style.top="-41px",g.style.left=0,g.style.right=0,g.style.width="100%",g.style.height="40px",g.style.backgroundColor="#ffffe1",g.style.border="none",g.style.borderBottom="1px solid #888888",g.style.zIndex="9999999","string"==typeof g.style.webkitTransition?g.style.webkitTransition="all .5s ease-out":"string"==typeof g.style.transition&&(g.style.transition="all .5s ease-out"),document.body.appendChild(g);var h=g.contentWindow?g.contentWindow:g.contentDocument.document?g.contentDocument.document:g.contentDocument;h.document.open(),h.document.write('<span style="display: inline-block; font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 4px; vertical-align: middle; cursor: default;">'+a+"</span>"),b&&c?(h.document.write('<button id="okay">'+b+'</button><button id="cancel">Cancel</button>'),h.document.close(),AdapterJS.addEvent(h.document.getElementById("okay"),"click",function(a){e&&AdapterJS.renderNotificationBar(AdapterJS.TEXT.EXTENSION?AdapterJS.TEXT.EXTENSION.REQUIRE_REFRESH:AdapterJS.TEXT.REFRESH.REQUIRE_REFRESH,AdapterJS.TEXT.REFRESH.BUTTON,"javascript:location.reload()"),window.open(c,d?"_blank":"_top"),a.preventDefault();try{a.cancelBubble=!0}catch(a){}var b=setInterval(function(){isIE||navigator.plugins.refresh(!1),AdapterJS.WebRTCPlugin.isPluginInstalled(AdapterJS.WebRTCPlugin.pluginInfo.prefix,AdapterJS.WebRTCPlugin.pluginInfo.plugName,function(){clearInterval(b),AdapterJS.WebRTCPlugin.defineWebRTCInterface()},function(){})},500)}),AdapterJS.addEvent(h.document.getElementById("cancel"),"click",function(a){f.document.body.removeChild(g)})):h.document.close(),setTimeout(function(){"string"==typeof g.style.webkitTransform?g.style.webkitTransform="translateY(40px)":"string"==typeof g.style.transform?g.style.transform="translateY(40px)":g.style.top="0px"},300)}},webrtcDetectedType=null,checkMediaDataChannelSettings=function(a,b,c,d){if("function"==typeof c){var e=!0,f="firefox"===webrtcDetectedBrowser,g="moz"===webrtcDetectedType&&webrtcDetectedVersion>30,h="firefox"===a;if(f&&h||g)try{delete d.mandatory.MozDontOfferDataChannel}catch(a){console.error("Failed deleting MozDontOfferDataChannel"),console.error(a)}else f&&!h&&(d.mandatory.MozDontOfferDataChannel=!0);if(!f)for(var i in d.mandatory)d.mandatory.hasOwnProperty(i)&&i.indexOf("Moz")!==-1&&delete d.mandatory[i];!f||h||g||(e=!1),c(e,d)}},checkIceConnectionState=function(a,b,c){return"function"!=typeof c?void console.warn("No callback specified in checkIceConnectionState. Aborted."):(a=a?a:"peer",AdapterJS._iceConnectionFiredStates[a]&&b!==AdapterJS._iceConnectionStates.disconnected&&b!==AdapterJS._iceConnectionStates.failed&&b!==AdapterJS._iceConnectionStates.closed||(AdapterJS._iceConnectionFiredStates[a]=[]),b=AdapterJS._iceConnectionStates[b],void(AdapterJS._iceConnectionFiredStates[a].indexOf(b)<0&&(AdapterJS._iceConnectionFiredStates[a].push(b),b===AdapterJS._iceConnectionStates.connected&&setTimeout(function(){AdapterJS._iceConnectionFiredStates[a].push(AdapterJS._iceConnectionStates.done),c(AdapterJS._iceConnectionStates.done)},1e3),c(b))))},createIceServer=null,createIceServers=null,RTCPeerConnection=null,RTCSessionDescription="function"==typeof RTCSessionDescription?RTCSessionDescription:null,RTCIceCandidate="function"==typeof RTCIceCandidate?RTCIceCandidate:null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,webrtcMinimumVersion=null,navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.adapter=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d={};d.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},d.localCName=d.generateIdentifier(),d.splitLines=function(a){return a.trim().split("\n").map(function(a){return a.trim()})},d.splitSections=function(a){var b=a.split("\nm=");return b.map(function(a,b){return(b>0?"m="+a:a).trim()+"\r\n"})},d.matchPrefix=function(a,b){return d.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},d.parseCandidate=function(a){var b;b=0===a.indexOf("a=candidate:")?a.substring(12).split(" "):a.substring(10).split(" ");for(var c={foundation:b[0],component:b[1],protocol:b[2].toLowerCase(),priority:parseInt(b[3],10),ip:b[4],port:parseInt(b[5],10),type:b[7]},d=8;d<b.length;d+=2)switch(b[d]){case"raddr":c.relatedAddress=b[d+1];break;case"rport":c.relatedPort=parseInt(b[d+1],10);break;case"tcptype":c.tcpType=b[d+1]}return c},d.writeCandidate=function(a){var b=[];b.push(a.foundation),b.push(a.component),b.push(a.protocol.toUpperCase()),b.push(a.priority),b.push(a.ip),b.push(a.port);var c=a.type;return b.push("typ"),b.push(c),"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort)),a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType)),"candidate:"+b.join(" ")},d.parseRtpMap=function(a){var b=a.substr(9).split(" "),c={payloadType:parseInt(b.shift(),10)};return b=b[0].split("/"),c.name=b[0],c.clockRate=parseInt(b[1],10),c.numChannels=3===b.length?parseInt(b[2],10):1,c},d.writeRtpMap=function(a){var b=a.payloadType;return void 0!==a.preferredPayloadType&&(b=a.preferredPayloadType),"a=rtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},d.parseExtmap=function(a){var b=a.substr(9).split(" ");return{id:parseInt(b[0],10),uri:b[1]}},d.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+" "+a.uri+"\r\n"},d.parseFmtp=function(a){for(var b,c={},d=a.substr(a.indexOf(" ")+1).split(";"),e=0;e<d.length;e++)b=d[e].trim().split("="),c[b[0].trim()]=b[1];return c},d.writeFmtp=function(a){var b="",c=a.payloadType;if(void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var d=[];Object.keys(a.parameters).forEach(function(b){d.push(b+"="+a.parameters[b])}),b+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return b},d.parseRtcpFb=function(a){var b=a.substr(a.indexOf(" ")+1).split(" ");return{type:b.shift(),parameter:b.join(" ")}},d.writeRtcpFb=function(a){var b="",c=a.payloadType;return void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a=rtcp-fb:"+c+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+"\r\n"}),b},d.parseSsrcMedia=function(a){var b=a.indexOf(" "),c={ssrc:parseInt(a.substr(7,b-7),10)},d=a.indexOf(":",b);return d>-1?(c.attribute=a.substr(b+1,d-b-1),c.value=a.substr(d+1)):c.attribute=a.substr(b+1),c},d.getDtlsParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e=c.filter(function(a){return 0===a.indexOf("a=fingerprint:")})[0].substr(14),f={role:"auto",fingerprints:[{algorithm:e.split(" ")[0],value:e.split(" ")[1]}]};return f},d.writeDtlsParameters=function(a,b){var c="a=setup:"+b+"\r\n";return a.fingerprints.forEach(function(a){c+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"}),c},d.getIceParameters=function(a,b){var c=d.splitLines(a);c=c.concat(d.splitLines(b));var e={usernameFragment:c.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:c.filter(function(a){return 0===a.indexOf("a=ice-pwd:")})[0].substr(10)};return e},d.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+"\r\na=ice-pwd:"+a.password+"\r\n"},d.parseRtpParameters=function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=d.splitLines(a),e=c[0].split(" "),f=3;f<e.length;f++){var g=e[f],h=d.matchPrefix(a,"a=rtpmap:"+g+" ")[0];if(h){var i=d.parseRtpMap(h),j=d.matchPrefix(a,"a=fmtp:"+g+" ");switch(i.parameters=j.length?d.parseFmtp(j[0]):{},i.rtcpFeedback=d.matchPrefix(a,"a=rtcp-fb:"+g+" ").map(d.parseRtcpFb),b.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":b.fecMechanisms.push(i.name.toUpperCase())}}}return d.matchPrefix(a,"a=extmap:").forEach(function(a){b.headerExtensions.push(d.parseExtmap(a))}),b},d.writeRtpDescription=function(a,b){var c="";return c+="m="+a+" ",c+=b.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",b.codecs.forEach(function(a){c+=d.writeRtpMap(a),c+=d.writeFmtp(a),c+=d.writeRtcpFb(a)}),c+="a=rtcp-mux\r\n"},d.parseRtpEncodingParameters=function(a){var b,c=[],e=d.parseRtpParameters(a),f=e.fecMechanisms.indexOf("RED")!==-1,g=e.fecMechanisms.indexOf("ULPFEC")!==-1,h=d.matchPrefix(a,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),i=h.length>0&&h[0].ssrc,j=d.matchPrefix(a,"a=ssrc-group:FID").map(function(a){var b=a.split(" ");return b.shift(),b.map(function(a){return parseInt(a,10)})});j.length>0&&j[0].length>1&&j[0][0]===i&&(b=j[0][1]),e.codecs.forEach(function(a){if("RTX"===a.name.toUpperCase()&&a.parameters.apt){var d={ssrc:i,codecPayloadType:parseInt(a.parameters.apt,10),rtx:{payloadType:a.payloadType,ssrc:b}};c.push(d),f&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:b,mechanism:g?"red+ulpfec":"red"},c.push(d))}}),0===c.length&&i&&c.push({ssrc:i});var k=d.matchPrefix(a,"b=");return k.length&&(0===k[0].indexOf("b=TIAS:")?k=parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")&&(k=parseInt(k[0].substr(5),10)),c.forEach(function(a){a.maxBitrate=k})),c},d.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(a,b,c,e){var f=d.writeRtpDescription(a.kind,b);if(f+=d.writeIceParameters(a.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),"offer"===c?"actpass":"active"),f+="a=mid:"+a.mid+"\r\n",f+=a.rtpSender&&a.rtpReceiver?"a=sendrecv\r\n":a.rtpSender?"a=sendonly\r\n":a.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",a.rtpSender){var g="msid:"+e.id+" "+a.rtpSender.track.id+"\r\n";f+="a="+g,f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+g}return f+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n"},d.getDirection=function(a,b){for(var c=d.splitLines(a),e=0;e<c.length;e++)switch(c[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[e].substr(2)}return b?d.getDirection(b):"sendrecv"},b.exports=d},{}],2:[function(a,b,c){"use strict";!function(){var c=a("./utils").log,d=a("./utils").browserDetails;b.exports.browserDetails=d,b.exports.extractVersion=a("./utils").extractVersion,b.exports.disableLog=a("./utils").disableLog;var e=a("./chrome/chrome_shim")||null,f=a("./edge/edge_shim")||null,g=a("./firefox/firefox_shim")||null,h=a("./safari/safari_shim")||null;switch(d.browser){case"opera":case"chrome":if(!e||!e.shimPeerConnection)return void c("Chrome shim is not included in this adapter release.");c("adapter.js shimming chrome."),b.exports.browserShim=e,e.shimGetUserMedia(),e.shimMediaStream(),e.shimSourceObject(),e.shimPeerConnection(),e.shimOnTrack();break;case"firefox":if(!g||!g.shimPeerConnection)return void c("Firefox shim is not included in this adapter release.");c("adapter.js shimming firefox."),b.exports.browserShim=g,g.shimGetUserMedia(),g.shimSourceObject(),g.shimPeerConnection(),g.shimOnTrack();break;case"edge":if(!f||!f.shimPeerConnection)return void c("MS edge shim is not included in this adapter release.");c("adapter.js shimming edge."),b.exports.browserShim=f,f.shimGetUserMedia(),f.shimPeerConnection();break;case"safari":if(!h)return void c("Safari shim is not included in this adapter release.");c("adapter.js shimming safari."),b.exports.browserShim=h,h.shimGetUserMedia();break;default:c("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(a,b,c){"use strict";var d=a("../utils.js").log,e=a("../utils.js").browserDetails,f={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){var b=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.addEventListener("addtrack",function(c){var d=new Event("track");d.track=c.track,d.receiver={track:c.track},d.streams=[a.stream],b.dispatchEvent(d)}),a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var b=this;return this._srcObject=a,this.src&&URL.revokeObjectURL(this.src),a?(this.src=URL.createObjectURL(a),a.addEventListener("addtrack",function(){b.src&&URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(a)}),void a.addEventListener("removetrack",function(){b.src&&URL.revokeObjectURL(b.src),b.src=URL.createObjectURL(a)})):void(this.src="")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(a,b){d("PeerConnection"),a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);var c=new webkitRTCPeerConnection(a,b),e=c.getStats.bind(c);return c.getStats=function(a,b,c){var d=this,f=arguments;if(arguments.length>0&&"function"==typeof a)return e(a,b);var g=function(a){var b={},c=a.result();return c.forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)}),b[c.id]=c}),b},h=function(a,b){var c=new Map(Object.keys(a).map(function(b){return[b,a[b]]}));return b=b||a,Object.keys(b).forEach(function(a){c[a]=b[a]}),c};if(arguments.length>=2){var i=function(a){f[1](h(g(a)))};return e.apply(this,[i,arguments[0]])}return new Promise(function(b,c){1===f.length&&"object"==typeof a?e.apply(d,[function(a){b(h(g(a)))},c]):e.apply(d,[function(a){b(h(g(a),a.result()))},c])}).then(b,c)},c},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var c=1===arguments.length?arguments[0]:void 0;return new Promise(function(d,e){b.apply(a,[d,e,c])})}return b.apply(this,arguments)}}),e.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,c=this,d=new Promise(function(d,e){b.apply(c,[a[0],d,e])});return a.length<2?d:d.then(function(){a[1].apply(null,[])},function(b){a.length>=3&&a[2].apply(null,[b])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){return arguments[0]=new("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}});var a=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():a.apply(this,arguments)}}};b.exports={shimMediaStream:f.shimMediaStream,shimOnTrack:f.shimOnTrack,shimSourceObject:f.shimSourceObject,shimPeerConnection:f.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils.js":10,"./getusermedia":4}],4:[function(a,b,c){"use strict";var d=a("../utils.js").log;b.exports=function(){var a=function(a){if("object"!=typeof a||a.mandatory||a.optional)return a;var b={};return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d="object"==typeof a[c]?a[c]:{ideal:a[c]};void 0!==d.exact&&"number"==typeof d.exact&&(d.min=d.max=d.exact);var e=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==d.ideal){b.optional=b.optional||[];var f={};"number"==typeof d.ideal?(f[e("min",c)]=d.ideal,b.optional.push(f),f={},f[e("max",c)]=d.ideal,b.optional.push(f)):(f[e("",c)]=d.ideal,b.optional.push(f))}void 0!==d.exact&&"number"!=typeof d.exact?(b.mandatory=b.mandatory||{},b.mandatory[e("",c)]=d.exact):["min","max"].forEach(function(a){void 0!==d[a]&&(b.mandatory=b.mandatory||{},b.mandatory[e(a,c)]=d[a])})}}),a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced)),b},b=function(b,c){if(b=JSON.parse(JSON.stringify(b)),b&&b.audio&&(b.audio=a(b.audio)),b&&"object"==typeof b.video){var e=b.video.facingMode;if(e=e&&("object"==typeof e?e:{ideal:e}),e&&("user"===e.exact||"environment"===e.exact||"user"===e.ideal||"environment"===e.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete b.video.facingMode,"environment"===e.exact||"environment"===e.ideal))return navigator.mediaDevices.enumerateDevices().then(function(f){f=f.filter(function(a){return"videoinput"===a.kind});var g=f.find(function(a){return a.label.toLowerCase().indexOf("back")!==-1})||f.length&&f[f.length-1];return g&&(b.video.deviceId=e.exact?{exact:g.deviceId}:{ideal:g.deviceId}),b.video=a(b.video),d("chrome: "+JSON.stringify(b)),c(b)});b.video=a(b.video)}return d("chrome: "+JSON.stringify(b)),c(b)},c=function(a){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},e=function(a,d,e){b(a,function(a){navigator.webkitGetUserMedia(a,d,function(a){e(c(a))})})};navigator.getUserMedia=e;var f=function(a){return new Promise(function(b,c){navigator.getUserMedia(a,b,c)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:f,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var g=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){return b(a,function(a){return g(a).catch(function(a){return Promise.reject(c(a))})})}}else navigator.mediaDevices.getUserMedia=function(a){return f(a)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){d("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){d("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(a,b,c){"use strict";var d=a("sdp"),e={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a}),window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a})),window.RTCPeerConnection=function(a){var b=this,c=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){b[a]=c[a].bind(c)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return b.localStreams},this.getRemoteStreams=function(){return b.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=a&&"max-bundle"===a.bundlePolicy,a&&a.iceServers){var d=JSON.parse(JSON.stringify(a.iceServers));this.iceOptions.iceServers=d.filter(function(a){if(a&&a.urls){var b=a.urls;return"string"==typeof b&&(b=[b]),b=b.filter(function(a){return 0===a.indexOf("turn:")&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1})[0],!!b}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this,b=d.splitSections(a.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(c){var d=!c.candidate||0===Object.keys(c.candidate).length;if(d)for(var e=1;e<b.length;e++)b[e].indexOf("\r\na=end-of-candidates\r\n")===-1&&(b[e]+="a=end-of-candidates\r\n");else c.candidate.candidate.indexOf("typ endOfCandidates")===-1&&(b[c.candidate.sdpMLineIndex+1]+="a="+c.candidate.candidate+"\r\n");if(a.localDescription.sdp=b.join(""),a.dispatchEvent(c),null!==a.onicecandidate&&a.onicecandidate(c),!c.candidate&&"complete"!==a.iceGatheringState){var f=a.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});f&&(a.iceGatheringState="complete")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(a){this.localStreams.push(a.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(a){var b=this.localStreams.indexOf(a);b>-1&&(this.localStreams.splice(b,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]};return a.codecs.forEach(function(a){for(var d=0;d<b.codecs.length;d++){var e=b.codecs[d];if(a.name.toLowerCase()===e.name.toLowerCase()&&a.clockRate===e.clockRate&&a.numChannels===e.numChannels){c.codecs.push(e),e.rtcpFeedback=e.rtcpFeedback.filter(function(b){for(var c=0;c<a.rtcpFeedback.length;c++)if(a.rtcpFeedback[c].type===b.type&&a.rtcpFeedback[c].parameter===b.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(a){for(var d=0;d<b.headerExtensions.length;d++){var e=b.headerExtensions[d];if(a.uri===e.uri){c.headerExtensions.push(e);break}}}),c},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,b){var c=this,e=new RTCIceGatherer(c.iceOptions),f=new RTCIceTransport(e);e.onlocalcandidate=function(g){var h=new Event("icecandidate");h.candidate={sdpMid:a,sdpMLineIndex:b};var i=g.candidate,j=!i||0===Object.keys(i).length;j?(void 0===e.state&&(e.state="completed"),h.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(i.component="RTCP"===f.component?2:1,h.candidate.candidate=d.writeCandidate(i));var k=d.splitSections(c.localDescription.sdp);h.candidate.candidate.indexOf("typ endOfCandidates")===-1?k[h.candidate.sdpMLineIndex+1]+="a="+h.candidate.candidate+"\r\n":k[h.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",c.localDescription.sdp=k.join("");var l=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});switch(c.iceGatheringState){case"new":c._localIceCandidatesBuffer.push(h),j&&l&&c._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":c._emitBufferedCandidates(),c.dispatchEvent(h),null!==c.onicecandidate&&c.onicecandidate(h),l&&(c.dispatchEvent(new Event("icecandidate")),null!==c.onicecandidate&&c.onicecandidate(new Event("icecandidate")),c.iceGatheringState="complete");break;case"complete":}},f.onicestatechange=function(){c._updateConnectionState()};var g=new RTCDtlsTransport(f);return g.ondtlsstatechange=function(){c._updateConnectionState()},g.onerror=function(){g.state="failed",c._updateConnectionState()},{iceGatherer:e,iceTransport:f,dtlsTransport:g}},window.RTCPeerConnection.prototype._transceive=function(a,b,c){var e=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(e.encodings=a.sendEncodingParameters,e.rtcp={cname:d.localCName},a.recvEncodingParameters.length&&(e.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(e)),c&&a.rtpReceiver&&(e.encodings=a.recvEncodingParameters,e.rtcp={cname:a.cname},a.sendEncodingParameters.length&&(e.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(e))},window.RTCPeerConnection.prototype.setLocalDescription=function(a){var b,c,e=this;if("offer"===a.type)this._pendingOffer&&(b=d.splitSections(a.sdp),c=b.shift(),b.forEach(function(a,b){var c=d.parseRtpParameters(a);e._pendingOffer[b].localCapabilities=c}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){b=d.splitSections(e.remoteDescription.sdp),c=b.shift();var f=d.matchPrefix(c,"a=ice-lite").length>0;b.forEach(function(a,b){var g=e.transceivers[b],h=g.iceGatherer,i=g.iceTransport,j=g.dtlsTransport,k=g.localCapabilities,l=g.remoteCapabilities,m="0"===a.split("\n",1)[0].split(" ",2)[1];if(!m){var n=d.getIceParameters(a,c);if(f){var o=d.matchPrefix(a,"a=candidate:").map(function(a){return d.parseCandidate(a)}).filter(function(a){return"1"===a.component});o.length&&i.setRemoteCandidates(o)}var p=d.getDtlsParameters(a,c);f&&(p.role="server"),e.usingBundle&&0!==b||(i.start(h,n,f?"controlling":"controlled"),j.start(p));var q=e._getCommonCapabilities(k,l);e._transceive(g,q.codecs.length>0,!1)}})}switch(this.localDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}var g=arguments.length>1&&"function"==typeof arguments[1];if(g){var h=arguments[1];window.setTimeout(function(){
h(),"new"===e.iceGatheringState&&(e.iceGatheringState="gathering"),e._emitBufferedCandidates()},0)}var i=Promise.resolve();return i.then(function(){g||("new"===e.iceGatheringState&&(e.iceGatheringState="gathering"),window.setTimeout(e._emitBufferedCandidates.bind(e),500))}),i},window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var b=this,c=new MediaStream,e=[],f=d.splitSections(a.sdp),g=f.shift(),h=d.matchPrefix(g,"a=ice-lite").length>0;switch(this.usingBundle=d.matchPrefix(g,"a=group:BUNDLE ").length>0,f.forEach(function(f,i){var j,k,l,m,n,o,p,q,r,s,t,u,v=d.splitLines(f),w=v[0].substr(2).split(" "),x=w[0],y="0"===w[1],z=d.getDirection(f,g),A=d.parseRtpParameters(f);y||(t=d.getIceParameters(f,g),u=d.getDtlsParameters(f,g),u.role="client"),q=d.parseRtpEncodingParameters(f);var B=d.matchPrefix(f,"a=mid:");B=B.length?B[0].substr(6):d.generateIdentifier();var C,D=d.matchPrefix(f,"a=ssrc:").map(function(a){return d.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0];D&&(C=D.value);var E=d.matchPrefix(f,"a=end-of-candidates",g).length>0,F=d.matchPrefix(f,"a=candidate:").map(function(a){return d.parseCandidate(a)}).filter(function(a){return"1"===a.component});if("offer"!==a.type||y)"answer"!==a.type||y||(j=b.transceivers[i],k=j.iceGatherer,l=j.iceTransport,m=j.dtlsTransport,n=j.rtpSender,o=j.rtpReceiver,p=j.sendEncodingParameters,r=j.localCapabilities,b.transceivers[i].recvEncodingParameters=q,b.transceivers[i].remoteCapabilities=A,b.transceivers[i].cname=C,(h||E)&&F.length&&l.setRemoteCandidates(F),b.usingBundle&&0!==i||(l.start(k,t,"controlling"),m.start(u)),b._transceive(j,"sendrecv"===z||"recvonly"===z,"sendrecv"===z||"sendonly"===z),!o||"sendrecv"!==z&&"sendonly"!==z?delete j.rtpReceiver:(s=o.track,e.push([s,o]),c.addTrack(s)));else{var G=b.usingBundle&&i>0?{iceGatherer:b.transceivers[0].iceGatherer,iceTransport:b.transceivers[0].iceTransport,dtlsTransport:b.transceivers[0].dtlsTransport}:b._createIceAndDtlsTransports(B,i);if(E&&G.iceTransport.setRemoteCandidates(F),r=RTCRtpReceiver.getCapabilities(x),p=[{ssrc:1001*(2*i+2)}],o=new RTCRtpReceiver(G.dtlsTransport,x),s=o.track,e.push([s,o]),c.addTrack(s),b.localStreams.length>0&&b.localStreams[0].getTracks().length>=i){var H;"audio"===x?H=b.localStreams[0].getAudioTracks()[0]:"video"===x&&(H=b.localStreams[0].getVideoTracks()[0]),H&&(n=new RTCRtpSender(H,G.dtlsTransport))}b.transceivers[i]={iceGatherer:G.iceGatherer,iceTransport:G.iceTransport,dtlsTransport:G.dtlsTransport,localCapabilities:r,remoteCapabilities:A,rtpSender:n,rtpReceiver:o,kind:x,mid:B,cname:C,sendEncodingParameters:p,recvEncodingParameters:q},b._transceive(b.transceivers[i],!1,"sendrecv"===z||"sendonly"===z)}}),this.remoteDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}return c.getTracks().length&&(b.remoteStreams.push(c),window.setTimeout(function(){var a=new Event("addstream");a.stream=c,b.dispatchEvent(a),null!==b.onaddstream&&window.setTimeout(function(){b.onaddstream(a)},0),e.forEach(function(d){var e=d[0],f=d[1],g=new Event("track");g.track=e,g.receiver=f,g.streams=[c],b.dispatchEvent(a),null!==b.ontrack&&window.setTimeout(function(){b.ontrack(g)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;var b=new Event("signalingstatechange");this.dispatchEvent(b),null!==this.onsignalingstatechange&&this.onsignalingstatechange(b)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var a=new Event("negotiationneeded");this.dispatchEvent(a),null!==this.onnegotiationneeded&&this.onnegotiationneeded(a)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var a,b=this,c={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(a){c[a.iceTransport.state]++,c[a.dtlsTransport.state]++}),c.connected+=c.completed,a="new",c.failed>0?a="failed":c.connecting>0||c.checking>0?a="connecting":c.disconnected>0?a="disconnected":c.new>0?a="new":(c.connected>0||c.completed>0)&&(a="connected"),a!==b.iceConnectionState){b.iceConnectionState=a;var d=new Event("iceconnectionstatechange");this.dispatchEvent(d),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(d)}},window.RTCPeerConnection.prototype.createOffer=function(){var a=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var b;1===arguments.length&&"function"!=typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var c=[],e=0,f=0;if(this.localStreams.length&&(e=this.localStreams[0].getAudioTracks().length,f=this.localStreams[0].getVideoTracks().length),b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&(e=b.offerToReceiveAudio),void 0!==b.offerToReceiveVideo&&(f=b.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){c.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?e>0:f>0}),"audio"===a.kind?e--:"video"===a.kind&&f--});e>0||f>0;)e>0&&(c.push({kind:"audio",wantReceive:!0}),e--),f>0&&(c.push({kind:"video",wantReceive:!0}),f--);var g=d.writeSessionBoilerplate(),h=[];c.forEach(function(b,c){var e,f,g=b.track,i=b.kind,j=d.generateIdentifier(),k=a.usingBundle&&c>0?{iceGatherer:h[0].iceGatherer,iceTransport:h[0].iceTransport,dtlsTransport:h[0].dtlsTransport}:a._createIceAndDtlsTransports(j,c),l=RTCRtpSender.getCapabilities(i),m=[{ssrc:1001*(2*c+1)}];g&&(e=new RTCRtpSender(g,k.dtlsTransport)),b.wantReceive&&(f=new RTCRtpReceiver(k.dtlsTransport,i)),h[c]={iceGatherer:k.iceGatherer,iceTransport:k.iceTransport,dtlsTransport:k.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:e,rtpReceiver:f,kind:i,mid:j,sendEncodingParameters:m,recvEncodingParameters:null}}),this.usingBundle&&(g+="a=group:BUNDLE "+h.map(function(a){return a.mid}).join(" ")+"\r\n"),c.forEach(function(b,c){var e=h[c];g+=d.writeMediaSection(e,e.localCapabilities,"offer",a.localStreams[0])}),this._pendingOffer=h;var i=new RTCSessionDescription({type:"offer",sdp:g});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},window.RTCPeerConnection.prototype.createAnswer=function(){var a=this,b=d.writeSessionBoilerplate();this.usingBundle&&(b+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(c){var e=a._getCommonCapabilities(c.localCapabilities,c.remoteCapabilities);b+=d.writeMediaSection(c,e,"answer",a.localStreams[0])});var c=new RTCSessionDescription({type:"answer",sdp:b});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.addIceCandidate=function(a){if(null===a)this.transceivers.forEach(function(a){a.iceTransport.addRemoteCandidate({})});else{var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}var e=this.transceivers[b];if(e){var f=Object.keys(a.candidate).length>0?d.parseCandidate(a.candidate):{};if("tcp"===f.protocol&&(0===f.port||9===f.port))return;if("1"!==f.component)return;"endOfCandidates"===f.type&&(f={}),e.iceTransport.addRemoteCandidate(f);var g=d.splitSections(this.remoteDescription.sdp);g[b+1]+=(f.type?a.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=g.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(c){var d=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){d.set(b,a[b]),d[b]=a[b]})}),b&&window.setTimeout(b,0,d),c(d)})})}}};b.exports={shimPeerConnection:e.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"./getusermedia":6,sdp:1}],6:[function(a,b,c){"use strict";b.exports=function(){var a=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,constraint:a.constraint,toString:function(){return this.name}}},b=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return b(c).catch(function(b){return Promise.reject(a(b))})}}},{}],7:[function(a,b,c){"use strict";var d=a("../utils").browserDetails,e={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=a),this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b,c.receiver={track:b},c.streams=[a.stream],this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(a,b){if(d.version<38&&a&&a.iceServers){for(var c=[],e=0;e<a.iceServers.length;e++){var f=a.iceServers[e];if(f.hasOwnProperty("urls"))for(var g=0;g<f.urls.length;g++){var h={url:f.urls[g]};0===f.urls[g].indexOf("turn")&&(h.username=f.username,h.credential=f.credential),c.push(h)}else c.push(a.iceServers[e])}a.iceServers=c}return new mozRTCPeerConnection(a,b)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){return arguments[0]=new("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}});var a=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():a.apply(this,arguments)};var b=function(a){var b=new Map;return Object.keys(a).forEach(function(c){b.set(c,a[c]),b[c]=a[c]}),b},c=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(a,d,e){return c.apply(this,[a||null]).then(function(a){return b(a)}).then(d,e)}}}};b.exports={shimOnTrack:e.shimOnTrack,shimSourceObject:e.shimSourceObject,shimPeerConnection:e.shimPeerConnection,shimGetUserMedia:a("./getusermedia")}},{"../utils":10,"./getusermedia":8}],8:[function(a,b,c){"use strict";var d=a("../utils").log,e=a("../utils").browserDetails;b.exports=function(){var a=function(a){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},b=function(b,c,f){var g=function(a){if("object"!=typeof a||a.require)return a;var b=[];return Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var d=a[c]="object"==typeof a[c]?a[c]:{ideal:a[c]};if(void 0===d.min&&void 0===d.max&&void 0===d.exact||b.push(c),void 0!==d.exact&&("number"==typeof d.exact?d.min=d.max=d.exact:a[c]=d.exact,delete d.exact),void 0!==d.ideal){a.advanced=a.advanced||[];var e={};"number"==typeof d.ideal?e[c]={min:d.ideal,max:d.ideal}:e[c]=d.ideal,a.advanced.push(e),delete d.ideal,Object.keys(d).length||delete a[c]}}}),b.length&&(a.require=b),a};return b=JSON.parse(JSON.stringify(b)),e.version<38&&(d("spec: "+JSON.stringify(b)),b.audio&&(b.audio=g(b.audio)),b.video&&(b.video=g(b.video)),d("ff37: "+JSON.stringify(b))),navigator.mozGetUserMedia(b,c,function(b){f(a(b))})},c=function(a){return new Promise(function(c,d){b(a,c,d)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){var b=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];a(b)})},e.version<41){var f=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return f().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a})}}if(e.version<49){var g=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(b){return g(b).catch(function(b){return Promise.reject(a(b))})}}navigator.getUserMedia=function(a,c,d){return e.version<44?b(a,c,d):(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),void navigator.mediaDevices.getUserMedia(a).then(c,d))}}},{"../utils":10}],9:[function(a,b,c){"use strict";var d={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};b.exports={shimGetUserMedia:d.shimGetUserMedia}},{}],10:[function(a,b,c){"use strict";var d=!0,e={disableLog:function(a){return"boolean"!=typeof a?new Error("Argument type: "+typeof a+". Please use a boolean."):(d=a,a?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(d)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(a,b,c){var d=a.match(b);return d&&d.length>=c&&parseInt(d[c],10)},detectBrowser:function(){var a={};if(a.browser=null,a.version=null,"undefined"==typeof window||!window.navigator)return a.browser="Not a browser.",a;if(navigator.mozGetUserMedia)a.browser="firefox",a.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",a;a.browser="safari",a.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return a.browser="Not a supported browser.",a;a.browser="edge",a.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return a}};b.exports={log:e.log,disableLog:e.disableLog,browserDetails:e.detectBrowser(),extractVersion:e.extractVersion}},{}]},{},[2])(2)}),AdapterJS.parseWebrtcDetectedBrowser(),navigator.mozGetUserMedia?(MediaStreamTrack.getSources=function(a){setTimeout(function(){var b=[{kind:"audio",id:"default",label:"",facing:""},{kind:"video",id:"default",label:"",facing:""}];a(b)},0)},createIceServer=function(a,b,c){console.warn("createIceServer is deprecated. It should be replaced with an application level implementation.");var d=null,e=a.split(":");if(0===e[0].indexOf("stun"))d={urls:[a]};else if(0===e[0].indexOf("turn"))if(webrtcDetectedVersion<27){var f=a.split("?");1!==f.length&&0!==f[1].indexOf("transport=udp")||(d={urls:[f[0]],credential:c,username:b})}else d={urls:[a],credential:c,username:b};return d},createIceServers=function(a,b,c){console.warn("createIceServers is deprecated. It should be replaced with an application level implementation.");var d=[];for(i=0;i<a.length;i++){var e=createIceServer(a[i],b,c);null!==e&&d.push(e)}return d}):navigator.webkitGetUserMedia&&(createIceServer=function(a,b,c){console.warn("createIceServer is deprecated. It should be replaced with an application level implementation.");var d=null,e=a.split(":");return 0===e[0].indexOf("stun")?d={url:a}:0===e[0].indexOf("turn")&&(d={url:a,credential:c,username:b}),d},createIceServers=function(a,b,c){console.warn("createIceServers is deprecated. It should be replaced with an application level implementation.");var d=[];if(webrtcDetectedVersion>=34)d={urls:a,credential:c,username:b};else for(i=0;i<a.length;i++){var e=createIceServer(a[i],b,c);null!==e&&d.push(e)}return d}),navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)&&(getUserMedia=window.getUserMedia=navigator.getUserMedia.bind(navigator),attachMediaStream=function(a,b){return a.srcObject=b,a},reattachMediaStream=function(a,b){return a.srcObject=b.srcObject,a}),attachMediaStream&&(attachMediaStream_base=attachMediaStream,attachMediaStream=function(a,b){return"chrome"!==webrtcDetectedBrowser&&"opera"!==webrtcDetectedBrowser||b?attachMediaStream_base(a,b):a.src="",a}),reattachMediaStream&&(reattachMediaStream_base=reattachMediaStream,reattachMediaStream=function(a,b){return reattachMediaStream_base(a,b),a}),window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=getUserMedia,AdapterJS.attachMediaStream=attachMediaStream,AdapterJS.reattachMediaStream=reattachMediaStream,AdapterJS.getUserMedia=getUserMedia,"undefined"==typeof Promise&&(requestUserMedia=null),AdapterJS.maybeThroughWebRTCReady()):("object"==typeof console&&"function"==typeof console.log||(console={}||console,console.log=function(a){},console.info=function(a){},console.error=function(a){},console.dir=function(a){},console.exception=function(a){},console.trace=function(a){},console.warn=function(a){},console.count=function(a){},console.debug=function(a){},console.count=function(a){},console.time=function(a){},console.timeEnd=function(a){},console.group=function(a){},console.groupCollapsed=function(a){},console.groupEnd=function(a){}),AdapterJS.parseWebrtcDetectedBrowser(),isIE="IE"===webrtcDetectedBrowser,AdapterJS.WebRTCPlugin.WaitForPluginReady=function(){for(;AdapterJS.WebRTCPlugin.pluginState!==AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY;);},AdapterJS.WebRTCPlugin.callWhenPluginReady=function(a){if(AdapterJS.WebRTCPlugin.pluginState===AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY)a();else var b=setInterval(function(){AdapterJS.WebRTCPlugin.pluginState===AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY&&(clearInterval(b),a())},100)},AdapterJS.WebRTCPlugin.setLogLevel=function(a){AdapterJS.WebRTCPlugin.callWhenPluginReady(function(){AdapterJS.WebRTCPlugin.plugin.setLogLevel(a)})},AdapterJS.WebRTCPlugin.injectPlugin=function(){if("complete"===document.readyState&&AdapterJS.WebRTCPlugin.pluginState===AdapterJS.WebRTCPlugin.PLUGIN_STATES.INITIALIZING){if(AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.INJECTING,"IE"===webrtcDetectedBrowser&&webrtcDetectedVersion<=10){var a=document.createDocumentFragment();for(AdapterJS.WebRTCPlugin.plugin=document.createElement("div"),AdapterJS.WebRTCPlugin.plugin.innerHTML='<object id="'+AdapterJS.WebRTCPlugin.pluginInfo.pluginId+'" type="'+AdapterJS.WebRTCPlugin.pluginInfo.type+'" width="1" height="1"><param name="pluginId" value="'+AdapterJS.WebRTCPlugin.pluginInfo.pluginId+'" /> <param name="windowless" value="false" /> <param name="pageId" value="'+AdapterJS.WebRTCPlugin.pageId+'" /> <param name="onload" value="'+AdapterJS.WebRTCPlugin.pluginInfo.onload+'" /><param name="tag" value="'+AdapterJS.WebRTCPlugin.TAGS.NONE+'" />'+(AdapterJS.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+"</object>";AdapterJS.WebRTCPlugin.plugin.firstChild;)a.appendChild(AdapterJS.WebRTCPlugin.plugin.firstChild);document.body.appendChild(a),AdapterJS.WebRTCPlugin.plugin=document.getElementById(AdapterJS.WebRTCPlugin.pluginInfo.pluginId)}else AdapterJS.WebRTCPlugin.plugin=document.createElement("object"),AdapterJS.WebRTCPlugin.plugin.id=AdapterJS.WebRTCPlugin.pluginInfo.pluginId,isIE?(AdapterJS.WebRTCPlugin.plugin.width="1px",AdapterJS.WebRTCPlugin.plugin.height="1px"):(AdapterJS.WebRTCPlugin.plugin.width="0px",AdapterJS.WebRTCPlugin.plugin.height="0px"),AdapterJS.WebRTCPlugin.plugin.type=AdapterJS.WebRTCPlugin.pluginInfo.type,AdapterJS.WebRTCPlugin.plugin.innerHTML='<param name="onload" value="'+AdapterJS.WebRTCPlugin.pluginInfo.onload+'"><param name="pluginId" value="'+AdapterJS.WebRTCPlugin.pluginInfo.pluginId+'"><param name="windowless" value="false" /> '+(AdapterJS.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+'<param name="pageId" value="'+AdapterJS.WebRTCPlugin.pageId+'"><param name="tag" value="'+AdapterJS.WebRTCPlugin.TAGS.NONE+'" />',document.body.appendChild(AdapterJS.WebRTCPlugin.plugin);AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.INJECTED}},AdapterJS.WebRTCPlugin.isPluginInstalled=function(a,b,c,d){if(isIE){try{new ActiveXObject(a+"."+b)}catch(a){return void d()}c()}else{for(var e=navigator.plugins,f=0;f<e.length;f++)if(e[f].name.indexOf(b)>=0)return void c();d()}},AdapterJS.WebRTCPlugin.defineWebRTCInterface=function(){return AdapterJS.WebRTCPlugin.pluginState===AdapterJS.WebRTCPlugin.PLUGIN_STATES.READY?void console.error("AdapterJS - WebRTC interface has already been defined"):(AdapterJS.WebRTCPlugin.pluginState=AdapterJS.WebRTCPlugin.PLUGIN_STATES.INITIALIZING,AdapterJS.isDefined=function(a){return null!==a&&void 0!==a},createIceServer=function(a,b,c){var d=null,e=a.split(":");return 0===e[0].indexOf("stun")?d={url:a,hasCredentials:!1}:0===e[0].indexOf("turn")&&(d={url:a,hasCredentials:!0,credential:c,username:b}),d},createIceServers=function(a,b,c){for(var d=[],e=0;e<a.length;++e)d.push(createIceServer(a[e],b,c));return d},RTCSessionDescription=function(a){return AdapterJS.WebRTCPlugin.WaitForPluginReady(),AdapterJS.WebRTCPlugin.plugin.ConstructSessionDescription(a.type,a.sdp)},RTCPeerConnection=function(a,b){if(void 0!==a&&null!==a&&!Array.isArray(a.iceServers))throw new Error("Failed to construct 'RTCPeerConnection': Malformed RTCConfiguration");if("undefined"!=typeof b&&null!==b){var c=!1;if(c|="object"!=typeof b,c|=b.hasOwnProperty("mandatory")&&void 0!==b.mandatory&&null!==b.mandatory&&b.mandatory.constructor!==Object,c|=b.hasOwnProperty("optional")&&void 0!==b.optional&&null!==b.optional&&!Array.isArray(b.optional))throw new Error("Failed to construct 'RTCPeerConnection': Malformed constraints object")}AdapterJS.WebRTCPlugin.WaitForPluginReady();var d=null;if(a&&Array.isArray(a.iceServers)){d=a.iceServers;for(var e=0;e<d.length;e++)d[e].urls&&!d[e].url&&(d[e].url=d[e].urls),d[e].hasCredentials=AdapterJS.isDefined(d[e].username)&&AdapterJS.isDefined(d[e].credential)}if(AdapterJS.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION&&AdapterJS.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION>1)return d&&(a.iceServers=d),AdapterJS.WebRTCPlugin.plugin.PeerConnection(a);var f=b&&b.mandatory?b.mandatory:null,g=b&&b.optional?b.optional:null;return AdapterJS.WebRTCPlugin.plugin.PeerConnection(AdapterJS.WebRTCPlugin.pageId,d,f,g)},MediaStreamTrack=function(){},MediaStreamTrack.getSources=function(a){AdapterJS.WebRTCPlugin.callWhenPluginReady(function(){AdapterJS.WebRTCPlugin.plugin.GetSources(a)})},getUserMedia=function(a,b,c){a.audio=a.audio||!1,a.video=a.video||!1,AdapterJS.WebRTCPlugin.callWhenPluginReady(function(){AdapterJS.WebRTCPlugin.plugin.getUserMedia(a,b,c)})},window.navigator.getUserMedia=getUserMedia,navigator.mediaDevices||"undefined"==typeof Promise||(requestUserMedia=function(a){return new Promise(function(b,c){getUserMedia(a,b,c)})},navigator.mediaDevices={getUserMedia:requestUserMedia,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],id:a.id,deviceId:a.id,groupId:""}}))})})}}),attachMediaStream=function(a,b){if(a&&a.parentNode){var c;null===b?c="":("undefined"!=typeof b.enableSoundTracks&&b.enableSoundTracks(!0),c=b.id);var d=0===a.id.length?Math.random().toString(36).slice(2):a.id,e=a.nodeName.toLowerCase();if("object"!==e){var f;switch(e){case"audio":f=AdapterJS.WebRTCPlugin.TAGS.AUDIO;break;case"video":f=AdapterJS.WebRTCPlugin.TAGS.VIDEO;break;default:f=AdapterJS.WebRTCPlugin.TAGS.NONE}var g=document.createDocumentFragment(),h=document.createElement("div"),i="";for(a.className?i='class="'+a.className+'" ':a.attributes&&a.attributes.class&&(i='class="'+a.attributes.class.value+'" '),h.innerHTML='<object id="'+d+'" '+i+'type="'+AdapterJS.WebRTCPlugin.pluginInfo.type+'"><param name="pluginId" value="'+d+'" /> <param name="pageId" value="'+AdapterJS.WebRTCPlugin.pageId+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+c+'" /> <param name="tag" value="'+f+'" /> </object>';h.firstChild;)g.appendChild(h.firstChild);var j="",k="";a.clientWidth||a.clientHeight?(k=a.clientWidth,j=a.clientHeight):(a.width||a.height)&&(k=a.width,j=a.height),a.parentNode.insertBefore(g,a),g=document.getElementById(d),g.width=k,g.height=j,a.parentNode.removeChild(a)}else{for(var l=a.children,m=0;m!==l.length;++m)if("streamId"===l[m].name){l[m].value=c;break}a.setStreamId(c)}var n=document.getElementById(d);return AdapterJS.forwardEventHandlers(n,a,Object.getPrototypeOf(a)),n}},reattachMediaStream=function(a,b){for(var c=null,d=b.children,e=0;e!==d.length;++e)if("streamId"===d[e].name){AdapterJS.WebRTCPlugin.WaitForPluginReady(),c=AdapterJS.WebRTCPlugin.plugin.getStreamWithId(AdapterJS.WebRTCPlugin.pageId,d[e].value);break}return null!==c?attachMediaStream(a,c):void console.log("Could not find the stream associated with this element")},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=getUserMedia,AdapterJS.attachMediaStream=attachMediaStream,AdapterJS.reattachMediaStream=reattachMediaStream,AdapterJS.getUserMedia=getUserMedia,AdapterJS.forwardEventHandlers=function(a,b,c){properties=Object.getOwnPropertyNames(c);for(var d in properties)d&&(propName=properties[d],"function"==typeof propName.slice&&"on"===propName.slice(0,2)&&"function"==typeof b[propName]&&AdapterJS.addEvent(a,propName.slice(2),b[propName]));var e=Object.getPrototypeOf(c);e&&AdapterJS.forwardEventHandlers(a,b,e)},RTCIceCandidate=function(a){return a.sdpMid||(a.sdpMid=""),AdapterJS.WebRTCPlugin.WaitForPluginReady(),AdapterJS.WebRTCPlugin.plugin.ConstructIceCandidate(a.sdpMid,a.sdpMLineIndex,a.candidate)},AdapterJS.addEvent(document,"readystatechange",AdapterJS.WebRTCPlugin.injectPlugin),void AdapterJS.WebRTCPlugin.injectPlugin())},AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCb=AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCb||function(){AdapterJS.addEvent(document,"readystatechange",AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCbPriv),AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCbPriv()},AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCbPriv=function(){if(!AdapterJS.options.hidePluginInstallPrompt){var a=AdapterJS.WebRTCPlugin.pluginInfo.downloadLink;if(a){var b;b=AdapterJS.WebRTCPlugin.pluginInfo.portalLink?'This website requires you to install the  <a href="'+AdapterJS.WebRTCPlugin.pluginInfo.portalLink+'" target="_blank">'+AdapterJS.WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin</a> to work on this browser.":AdapterJS.TEXT.PLUGIN.REQUIRE_INSTALLATION,AdapterJS.renderNotificationBar(b,AdapterJS.TEXT.PLUGIN.BUTTON,a)}else AdapterJS.renderNotificationBar(AdapterJS.TEXT.PLUGIN.NOT_SUPPORTED)}},AdapterJS.WebRTCPlugin.isPluginInstalled(AdapterJS.WebRTCPlugin.pluginInfo.prefix,AdapterJS.WebRTCPlugin.pluginInfo.plugName,AdapterJS.WebRTCPlugin.defineWebRTCInterface,AdapterJS.WebRTCPlugin.pluginNeededButNotInstalledCb)),function(a){function b(a,b,d){return c(a,0,-1,b,d)}function c(a,b,c,d,e){for(var f=c!=-1?c:a.length,g=b;g<f;++g)if(0===a[g].indexOf(d)&&(!e||a[g].toLowerCase().indexOf(e.toLowerCase())!==-1))return g;return null}function d(a){var b=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),c=a.match(b);return c&&2==c.length?c[1]:null}function e(){}function f(){return!0}function g(a,b){console.log("There has been a problem retrieving the streams - did you allow access? Check Device Resolution",b),k(a,"onError",b)}function i(a,b){console.log("Stream Success"),k(a,"onStream",b)}function j(a,b){a.mediaData.candidate=b,a.mediaData.candidateList.push(a.mediaData.candidate),k(a,"onICE")}function k(a,b,c){b in a.options.callbacks&&a.options.callbacks[b](a,c)}function l(a,b){console.log("ICE Complete"),k(a,"onICEComplete")}function m(a,b){console.error("Channel Error",b),k(a,"onError",b)}function n(a,b){a.mediaData.SDP=a.stereoHack(b.sdp),console.log("ICE SDP"),k(a,"onICESDP")}function o(a,b){a.options.useVideo&&(a.options.useVideo.style.display="block");var c=a.options.useAudio;console.log("REMOTE STREAM",b,c),FSRTCattachMediaStream(c,b),a.options.useAudio.play(),a.remoteStream=b}function p(a,b){a.mediaData.SDP=a.stereoHack(b.sdp),console.log("Offer SDP"),k(a,"onOfferSDP")}function q(a){var b;a.options.useMic&&"none"===a.options.useMic?(console.log("Microphone Disabled"),b=!1):a.options.videoParams&&a.options.screenShare?(console.error("SCREEN SHARE",a.options.videoParams),b=!1):(b={},a.options.audioParams&&(b=a.options.audioParams),"any"!==a.options.useMic&&(b.deviceId={exact:a.options.useMic})),a.options.useVideo&&a.options.localVideo&&s({constraints:{audio:!1,video:a.options.videoParams},localVideo:a.options.localVideo,onsuccess:function(a){self.options.localVideoStream=a,console.log("local video ready")},onerror:function(a){console.error("local video error!")}});var c={},d=a.options.videoParams.vertoBestFrameRate,e=a.options.videoParams.minFrameRate||15;if(delete a.options.videoParams.vertoBestFrameRate,a.options.screenShare){var f=[];f.push({sourceId:a.options.useCamera}),d&&(f.push({minFrameRate:d}),f.push({maxFrameRate:d})),c={mandatory:a.options.videoParams,optional:f}}else{c={width:{min:a.options.videoParams.minWidth,max:a.options.videoParams.maxWidth},height:{min:a.options.videoParams.minHeight,max:a.options.videoParams.maxHeight}};var g=a.options.useVideo;g&&a.options.useCamera&&"none"!==a.options.useCamera?("any"!==a.options.useCamera&&(c.deviceId=a.options.useCamera),d&&(c.frameRate={ideal:d,min:e,max:30})):(console.log("Camera Disabled"),c=!1,g=!1)}return{audio:b,video:c,useVideo:g}}function r(a){function b(){l=!0,k=null,a.onICEComplete&&a.onICEComplete(),"offer"==a.type?a.onICESDP(o.localDescription):!p&&a.onICESDP&&a.onICESDP(o.localDescription)}function c(){a.onOfferSDP&&o.createOffer(function(b){b.sdp=e(b.sdp),o.setLocalDescription(b),a.onOfferSDP(b)},j,a.constraints)}function d(){"answer"==a.type&&(o.setRemoteDescription(new window.RTCSessionDescription(a.offerSDP),i,j),o.createAnswer(function(b){b.sdp=e(b.sdp),o.setLocalDescription(b),a.onAnswerSDP&&a.onAnswerSDP(b);
},j))}function e(a){return a}function f(){a.onChannelMessage&&g()}function g(){s=o.createDataChannel(a.channel||"RTCDataChannel",{reliable:!1}),h()}function h(){s.onmessage=function(b){a.onChannelMessage&&a.onChannelMessage(b)},s.onopen=function(){a.onChannelOpened&&a.onChannelOpened(s)},s.onclose=function(b){a.onChannelClosed&&a.onChannelClosed(b),console.warn("WebRTC DataChannel closed",b)},s.onerror=function(b){a.onChannelError&&a.onChannelError(b),console.error("WebRTC DataChannel error",b)}}function i(){}function j(b){a.onChannelError&&a.onChannelError(b),console.error("sdp error:",b)}var k=!1,l=!1,m={},n={urls:["stun:stun.l.google.com:19302"]};a.iceServers&&("boolean"==typeof a.iceServers?m.iceServers=[n]:m.iceServers=a.iceServers);var o=new window.RTCPeerConnection(m);f();var p=0;if(o.onicecandidate=function(c){l||(k||(k=setTimeout(b,1e3)),c?c.candidate&&a.onICE(c.candidate):(l=!0,k&&(clearTimeout(k),k=null),b()))},a.attachStream&&o.addStream(a.attachStream),a.attachStreams&&a.attachStream.length)for(var q=a.attachStreams,r=0;r<q.length;r++)o.addStream(q[r]);o.onaddstream=function(b){var c=b.stream;c.oninactive=function(){a.onRemoteStreamEnded&&a.onRemoteStreamEnded(c)},a.onRemoteStream&&a.onRemoteStream(c)},!a.onChannelMessage&&a.onChannelMessage||(c(),d());var s;return{addAnswerSDP:function(a,b,c){o.setRemoteDescription(new window.RTCSessionDescription(a),b?b:i,c?c:j)},addICE:function(a){o.addIceCandidate(new window.RTCIceCandidate({sdpMLineIndex:a.sdpMLineIndex,candidate:a.candidate}))},peer:o,channel:s,sendData:function(a){s&&s.send(a)},stop:function(){o.close(),a.attachStream&&("function"==typeof a.attachStream.stop?a.attachStream.stop():a.attachStream.active=!1)}}}function s(a){function b(b){a.localVideo&&(a.localVideo.src=window.URL.createObjectURL(b),a.localVideo.style.display="block"),a.onsuccess&&a.onsuccess(b),c=b}var c,d=navigator;return d.getMedia=d.getUserMedia,d.getMedia(a.constraints||{audio:!0,video:t},b,a.onerror||function(a){console.error(a)}),c}a.FSRTC=function(b){this.options=a.extend({useVideo:null,useStereo:!1,userData:null,localVideo:null,screenShare:!1,useCamera:"any",iceServers:!1,videoParams:{},audioParams:{},callbacks:{onICEComplete:function(){},onICE:function(){},onOfferSDP:function(){}}},b),this.audioEnabled=!0,this.videoEnabled=!0,this.mediaData={SDP:null,profile:{},candidateList:[]},this.constraints={offerToReceiveAudio:"none"!==this.options.useSpeak,offerToReceiveVideo:!!this.options.useVideo},self.options.useVideo&&(self.options.useVideo.style.display="none"),e(),f()},a.FSRTC.validRes=[],a.FSRTC.prototype.useVideo=function(a,b){var c=this;a?(c.options.useVideo=a,c.options.localVideo=b,c.constraints.offerToReceiveVideo=!0):(c.options.useVideo=null,c.options.localVideo=null,c.constraints.offerToReceiveVideo=!1),c.options.useVideo&&(c.options.useVideo.style.display="none")},a.FSRTC.prototype.useStereo=function(a){var b=this;b.options.useStereo=a},a.FSRTC.prototype.stereoHack=function(a){var c=this;if(!c.options.useStereo)return a;var e,f=a.split("\r\n"),g=b(f,"a=rtpmap","opus/48000");if(!g)return a;e=d(f[g]);var h=b(f,"a=fmtp:"+e.toString());return null===h?f[g]=f[g]+"\r\na=fmtp:"+e.toString()+" stereo=1; sprop-stereo=1":f[h]=f[h].concat("; stereo=1; sprop-stereo=1"),a=f.join("\r\n")},FSRTCattachMediaStream=function(a,b){a&&a.id&&attachMediaStream?attachMediaStream(a,b):"undefined"!=typeof a.srcObject?a.srcObject=b:"undefined"!=typeof a.src?a.src=URL.createObjectURL(b):console.error("Error attaching stream to element.")},a.FSRTC.prototype.answer=function(a,b,c){this.peer.addAnswerSDP({type:"answer",sdp:a},b,c)},a.FSRTC.prototype.stopPeer=function(){self.peer&&(console.log("stopping peer"),self.peer.stop())},a.FSRTC.prototype.stop=function(){var a=this;if(a.options.useVideo&&(a.options.useVideo.style.display="none",a.options.useVideo.src=""),a.localStream){if("function"==typeof a.localStream.stop)a.localStream.stop();else if(a.localStream.active){var b=a.localStream.getTracks();console.log(b),b.forEach(function(a,b){console.log(a),a.stop()})}a.localStream=null}if(a.options.localVideo&&(a.options.localVideo.style.display="none",a.options.localVideo.src=""),a.options.localVideoStream)if("function"==typeof a.options.localVideoStream.stop)a.options.localVideoStream.stop();else if(a.options.localVideoStream.active){var b=a.options.localVideoStream.getTracks();console.log(b),b.forEach(function(a,b){console.log(a),a.stop()})}a.peer&&(console.log("stopping peer"),a.peer.stop())},a.FSRTC.prototype.getMute=function(){var a=this;return a.audioEnabled},a.FSRTC.prototype.setMute=function(a){for(var b=this,c=b.localStream.getAudioTracks(),d=0,e=c.length;d<e;d++){switch(a){case"on":c[d].enabled=!0;break;case"off":c[d].enabled=!1;break;case"toggle":c[d].enabled=!c[d].enabled}b.audioEnabled=c[d].enabled}return!b.audioEnabled},a.FSRTC.prototype.getVideoMute=function(){var a=this;return a.videoEnabled},a.FSRTC.prototype.setVideoMute=function(a){for(var b=this,c=b.localStream.getVideoTracks(),d=0,e=c.length;d<e;d++){switch(a){case"on":c[d].enabled=!0;break;case"off":c[d].enabled=!1;break;case"toggle":c[d].enabled=!c[d].enabled}b.videoEnabled=c[d].enabled}return!b.videoEnabled},a.FSRTC.prototype.createAnswer=function(a){function b(a){d.localStream=a,d.peer=r({type:d.type,attachStream:d.localStream,onICE:function(a){return j(d,a)},onICEComplete:function(){return l(d)},onRemoteStream:function(a){return o(d,a)},onICESDP:function(a){return n(d,a)},onChannelError:function(a){return m(d,a)},constraints:d.constraints,iceServers:d.options.iceServers,offerSDP:{type:"offer",sdp:d.remoteSDP}}),i(d,a)}function c(a){g(d,a)}var d=this;d.type="answer",d.remoteSDP=a.sdp,console.debug("inbound sdp: ",a.sdp);var e=q(d);console.log("Audio constraints",e.audio),console.log("Video constraints",e.video),d.options.useVideo&&d.options.localVideo&&s({constraints:{audio:!1,video:{}},localVideo:d.options.localVideo,onsuccess:function(a){d.options.localVideoStream=a,console.log("local video ready")},onerror:function(a){console.error("local video error!")}}),s({constraints:{audio:e.audio,video:e.video},video:e.useVideo,onsuccess:b,onerror:c})},a.FSRTC.prototype.call=function(a){function b(a){d.localStream=a,e&&(d.constraints.offerToReceiveVideo=!1),d.peer=r({type:d.type,attachStream:d.localStream,onICE:function(a){return j(d,a)},onICEComplete:function(){return l(d)},onRemoteStream:e?function(a){}:function(a){return o(d,a)},onOfferSDP:function(a){return p(d,a)},onICESDP:function(a){return n(d,a)},onChannelError:function(a){return m(d,a)},constraints:d.constraints,iceServers:d.options.iceServers}),i(d,a)}function c(a){g(d,a)}f();var d=this,e=!1;d.type="offer",d.options.videoParams&&d.options.screenShare&&(e=!0);var h=q(d);console.log("Audio constraints",h.audio),console.log("Video constraints",h.video),h.audio||h.video?s({constraints:{audio:h.audio,video:h.video},video:h.useVideo,onsuccess:b,onerror:c}):b(null)};var t={};a.FSRTC.resSupported=function(b,c){for(var d in a.FSRTC.validRes)if(a.FSRTC.validRes[d][0]==b&&a.FSRTC.validRes[d][1]==c)return!0;return!1},a.FSRTC.bestResSupported=function(){var b=0,c=0;for(var d in a.FSRTC.validRes)a.FSRTC.validRes[d][0]>=b&&a.FSRTC.validRes[d][1]>=c&&(b=a.FSRTC.validRes[d][0],c=a.FSRTC.validRes[d][1]);return[b,c]};var u=[[160,120],[320,180],[320,240],[640,360],[640,480],[1280,720],[1920,1080]],v=0,x=0,y=function(b,c){if(v>=u.length){var d={validRes:a.FSRTC.validRes,bestResSupported:a.FSRTC.bestResSupported()};if(localStorage.setItem("res_"+b,a.toJSON(d)),c)return c(d)}else{var e={};b&&(e.deviceId={exact:b}),w=u[v][0],h=u[v][1],v++,e={width:w,height:h},s({constraints:{audio:0==x++,video:e},onsuccess:function(d){d.getTracks().forEach(function(a){a.stop()}),console.info(w+"x"+h+" supported."),a.FSRTC.validRes.push([w,h]),y(b,c)},onerror:function(a){console.warn(w+"x"+h+" not supported."),y(b,c)}})}};a.FSRTC.getValidRes=function(b,c){var d=localStorage.getItem("res_"+b);if(d){var e=a.parseJSON(d);return e?(a.FSRTC.validRes=e.validRes,console.log("CACHED RES FOR CAM "+b,e)):console.error("INVALID CACHE"),c?c(e):null}a.FSRTC.validRes=[],v=0,y(b,c)},a.FSRTC.checkPerms=function(b,c,d){s({constraints:{audio:c,video:d},onsuccess:function(a){a.getTracks().forEach(function(a){a.stop()}),console.info("media perm init complete"),b&&setTimeout(b,100,!0)},onerror:function(e){return d&&c?(console.error("error, retesting with audio params only"),a.FSRTC.checkPerms(b,c,!1)):(console.error("media perm init error"),void(b&&b(!1)))}})}}(jQuery),function(a){a.JsonRpcClient=function(b){var c=this;this.options=a.extend({ajaxUrl:null,socketUrl:null,onmessage:null,login:null,passwd:null,sessid:null,loginParams:null,userVariables:null,getSocket:function(a){return c._getSocket(a)}},b),c.ws_cnt=0,this.wsOnMessage=function(a){c._wsOnMessage(a)}},a.JsonRpcClient.prototype._ws_socket=null,a.JsonRpcClient.prototype._ws_callbacks={},a.JsonRpcClient.prototype._current_id=1,a.JsonRpcClient.prototype.speedTest=function(a,b){var c=this.options.getSocket(this.wsOnMessage);if(null!==c){this.speedCB=b,this.speedBytes=a,c.send("#SPU "+a);var d,e=a/1024,f=a%1024,g=new Array(1024).join(".");for(d=0;d<e;d++)c.send("#SPB "+g);f&&c.send("#SPB "+g),c.send("#SPE")}},a.JsonRpcClient.prototype.call=function(b,c,d,e){c||(c={}),this.options.sessid&&(c.sessid=this.options.sessid);var f={jsonrpc:"2.0",method:b,params:c,id:this._current_id++};d||(d=function(a){console.log("Success: ",a)}),e||(e=function(a){console.log("Error: ",a)});var g=this.options.getSocket(this.wsOnMessage);if(null!==g)return void this._wsCall(g,f,d,e);if(null===this.options.ajaxUrl)throw"$.JsonRpcClient.call used with no websocket and no http endpoint.";a.ajax({type:"POST",url:this.options.ajaxUrl,data:a.toJSON(f),dataType:"json",cache:!1,success:function(a){"error"in a&&e(a.error,this),d(a.result,this)},error:function(b,c,d){try{var f=a.parseJSON(b.responseText);"console"in window&&console.log(f),e(f.error,this)}catch(a){e({error:b.responseText},this)}}})},a.JsonRpcClient.prototype.notify=function(b,c){this.options.sessid&&(c.sessid=this.options.sessid);var d={jsonrpc:"2.0",method:b,params:c},e=this.options.getSocket(this.wsOnMessage);if(null!==e)return void this._wsCall(e,d);if(null===this.options.ajaxUrl)throw"$.JsonRpcClient.notify used with no websocket and no http endpoint.";a.ajax({type:"POST",url:this.options.ajaxUrl,data:a.toJSON(d),dataType:"json",cache:!1})},a.JsonRpcClient.prototype.batch=function(b,c,d){var e=new a.JsonRpcClient._batchObject(this,c,d);b(e),e._execute()},a.JsonRpcClient.prototype.socketReady=function(){return!(null===this._ws_socket||this._ws_socket.readyState>1)},a.JsonRpcClient.prototype.closeSocket=function(){var a=this;a.socketReady()&&(a._ws_socket.onclose=function(a){console.log("Closing Socket")},a._ws_socket.close())},a.JsonRpcClient.prototype.loginData=function(a){var b=this;b.options.login=a.login,b.options.passwd=a.passwd,b.options.loginParams=a.loginParams,b.options.userVariables=a.userVariables},a.JsonRpcClient.prototype.connectSocket=function(b){var c=this;return c.to&&clearTimeout(c.to),c.socketReady()||(c.authing=!1,c._ws_socket&&delete c._ws_socket,c._ws_socket=new WebSocket(c.options.socketUrl),c._ws_socket&&(c._ws_socket.onmessage=b,c._ws_socket.onclose=function(a){c.ws_sleep||(c.ws_sleep=1e3),c.options.onWSClose&&c.options.onWSClose(c),console.error("Websocket Lost "+c.ws_cnt+" sleep: "+c.ws_sleep+"msec"),c.to=setTimeout(function(){console.log("Attempting Reconnection...."),c.connectSocket(b)},c.ws_sleep),c.ws_cnt++,c.ws_sleep<3e3&&c.ws_cnt%10===0&&(c.ws_sleep+=1e3)},c._ws_socket.onopen=function(){c.to&&clearTimeout(c.to),c.ws_sleep=1e3,c.ws_cnt=0,c.options.onWSConnect&&c.options.onWSConnect(c);for(var b;b=a.JsonRpcClient.q.pop();)c._ws_socket.send(b)})),!!c._ws_socket},a.JsonRpcClient.prototype._getSocket=function(a){return null!==this.options.socketUrl&&"WebSocket"in window?(this.connectSocket(a),this._ws_socket):null},a.JsonRpcClient.q=[],a.JsonRpcClient.prototype._wsCall=function(b,c,d,e){var f=a.toJSON(c);b.readyState<1?(self=this,a.JsonRpcClient.q.push(f)):b.send(f),"id"in c&&"undefined"!=typeof d&&(this._ws_callbacks[c.id]={request:f,request_obj:c,success_cb:d,error_cb:e})},a.JsonRpcClient.prototype._wsOnMessage=function(b){var c;if("#"!=b.data[0]||"S"!=b.data[1]||"P"!=b.data[2]){try{if(c=a.parseJSON(b.data),"object"==typeof c&&"jsonrpc"in c&&"2.0"===c.jsonrpc){if("result"in c&&this._ws_callbacks[c.id]){var d=this._ws_callbacks[c.id].success_cb;return delete this._ws_callbacks[c.id],void d(c.result,this)}if("error"in c&&this._ws_callbacks[c.id]){var e=this._ws_callbacks[c.id].error_cb,f=this._ws_callbacks[c.id].request;return!self.authing&&c.error.code==-32e3&&self.options.login&&self.options.passwd?(self.authing=!0,void this.call("login",{login:self.options.login,passwd:self.options.passwd,loginParams:self.options.loginParams,userVariables:self.options.userVariables},"login"==this._ws_callbacks[c.id].request_obj.method?function(a){self.authing=!1,console.log("logged in"),delete self._ws_callbacks[c.id],self.options.onWSLogin&&self.options.onWSLogin(!0,self)}:function(a){self.authing=!1,console.log("logged in, resending request id: "+c.id);var b=self.options.getSocket(self.wsOnMessage);null!==b&&b.send(f),self.options.onWSLogin&&self.options.onWSLogin(!0,self)},function(a){console.log("error logging in, request id:",c.id),delete self._ws_callbacks[c.id],e(c.error,this),self.options.onWSLogin&&self.options.onWSLogin(!1,self)})):(delete this._ws_callbacks[c.id],void e(c.error,this))}}}catch(a){return void console.log("ERROR: "+a)}if("function"==typeof this.options.onmessage){b.eventData=c,b.eventData||(b.eventData={});var g=this.options.onmessage(b);if(g&&"object"==typeof g&&b.eventData.id){var h={jsonrpc:"2.0",id:b.eventData.id,result:g},i=self.options.getSocket(self.wsOnMessage);null!==i&&i.send(a.toJSON(h))}}}else if("U"==b.data[3])this.up_dur=parseInt(b.data.substring(4));else if(this.speedCB&&"D"==b.data[3]){this.down_dur=parseInt(b.data.substring(4));var j=(8*this.speedBytes/(this.up_dur/1e3)/1024).toFixed(0),k=(8*this.speedBytes/(this.down_dur/1e3)/1024).toFixed(0);console.info("Speed Test: Up: "+j+" Down: "+k),this.speedCB(b,{upDur:this.up_dur,downDur:this.down_dur,upKPS:j,downKPS:k}),this.speedCB=null}},a.JsonRpcClient._batchObject=function(a,b,c){this._requests=[],this.jsonrpcclient=a,this.all_done_cb=b,this.error_cb="function"==typeof c?c:function(){}},a.JsonRpcClient._batchObject.prototype.call=function(a,b,c,d){b||(b={}),this.options.sessid&&(b.sessid=this.options.sessid),c||(c=function(a){console.log("Success: ",a)}),d||(d=function(a){console.log("Error: ",a)}),this._requests.push({request:{jsonrpc:"2.0",method:a,params:b,id:this.jsonrpcclient._current_id++},success_cb:c,error_cb:d})},a.JsonRpcClient._batchObject.prototype.notify=function(a,b){this.options.sessid&&(b.sessid=this.options.sessid),this._requests.push({request:{jsonrpc:"2.0",method:a,params:b}})},a.JsonRpcClient._batchObject.prototype._execute=function(){var b=this;if(0!==this._requests.length){var c,d,e,f=[],g={},h=0,i=b.jsonrpcclient.options.getSocket(b.jsonrpcclient.wsOnMessage);if(null!==i){for(h=0;h<this._requests.length;h++)c=this._requests[h],d="success_cb"in c?c.success_cb:void 0,e="error_cb"in c?c.error_cb:void 0,b.jsonrpcclient._wsCall(i,c.request,d,e);return void("function"==typeof all_done_cb&&all_done_cb(result))}for(h=0;h<this._requests.length;h++)c=this._requests[h],f.push(c.request),"id"in c.request&&(g[c.request.id]={success_cb:c.success_cb,error_cb:c.error_cb});if(d=function(a){b._batchCb(a,g,b.all_done_cb)},null===b.jsonrpcclient.options.ajaxUrl)throw"$.JsonRpcClient.batch used with no websocket and no http endpoint.";a.ajax({url:b.jsonrpcclient.options.ajaxUrl,data:a.toJSON(f),dataType:"json",cache:!1,type:"POST",error:function(a,c,d){b.error_cb(a,c,d)},success:d})}},a.JsonRpcClient._batchObject.prototype._batchCb=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"error"in e?null!==e.id&&e.id in b?b[e.id].error_cb(e.error,this):"console"in window&&console.log(e):!(e.id in b)&&"console"in window?console.log(e):b[e.id].success_cb(e.result,this)}"function"==typeof c&&c(a)}}(jQuery),function(a){function b(a,b){console.error("drop unauthorized channel: "+b),delete a.eventSUBS[b]}function c(a,b){for(var c in a.eventSUBS[b])a.eventSUBS[b][c].ready=!0,console.log("subscribed to channel: "+b),a.eventSUBS[b][c].readyHandler&&a.eventSUBS[b][c].readyHandler(a,b)}function d(a,b,c,d){var e=d||{},f=e.local,g={eventChannel:b,userData:e.userData,handler:e.handler,ready:!1,readyHandler:e.readyHandler,serno:i++},h=!1;return a.eventSUBS[b]||(a.eventSUBS[b]=[],c.push(b),h=!0),a.eventSUBS[b].push(g),f&&(g.ready=!0,g.local=!0),!h&&a.eventSUBS[b][0].ready&&(g.ready=!0,g.readyHandler&&g.readyHandler(a,b)),{serno:g.serno,eventChannel:b}}function e(){a.verto.conf.prototype.listVideoLayouts=function(){this.modCommand("list-videoLayouts",null,null)},a.verto.conf.prototype.play=function(a){this.modCommand("play",null,a)},a.verto.conf.prototype.stop=function(){this.modCommand("stop",null,"all")},a.verto.conf.prototype.deaf=function(a){this.modCommand("deaf",parseInt(a))},a.verto.conf.prototype.undeaf=function(a){this.modCommand("undeaf",parseInt(a))},a.verto.conf.prototype.record=function(a){this.modCommand("recording",null,["start",a])},a.verto.conf.prototype.stopRecord=function(){this.modCommand("recording",null,["stop","all"])},a.verto.conf.prototype.snapshot=function(a){if(!this.params.hasVid)throw"Conference has no video";this.modCommand("vid-write-png",null,a)},a.verto.conf.prototype.setVideoLayout=function(a,b){if(!this.params.hasVid)throw"Conference has no video";b?this.modCommand("vid-layout",null,[a,b]):this.modCommand("vid-layout",null,a)},a.verto.conf.prototype.kick=function(a){this.modCommand("kick",parseInt(a))},a.verto.conf.prototype.muteMic=function(a){this.modCommand("tmute",parseInt(a))},a.verto.conf.prototype.muteVideo=function(a){if(!this.params.hasVid)throw"Conference has no video";this.modCommand("tvmute",parseInt(a))},a.verto.conf.prototype.presenter=function(a){if(!this.params.hasVid)throw"Conference has no video";this.modCommand("vid-res-id",parseInt(a),"presenter")},a.verto.conf.prototype.videoFloor=function(a){if(!this.params.hasVid)throw"Conference has no video";this.modCommand("vid-floor",parseInt(a),"force")},a.verto.conf.prototype.banner=function(a,b){if(!this.params.hasVid)throw"Conference has no video";this.modCommand("vid-banner",parseInt(a),escape(b))},a.verto.conf.prototype.volumeDown=function(a){this.modCommand("volume_out",parseInt(a),"down")},a.verto.conf.prototype.volumeUp=function(a){this.modCommand("volume_out",parseInt(a),"up")},a.verto.conf.prototype.gainDown=function(a){this.modCommand("volume_in",parseInt(a),"down")},a.verto.conf.prototype.gainUp=function(a){this.modCommand("volume_in",parseInt(a),"up")},a.verto.conf.prototype.transfer=function(a,b){this.modCommand("transfer",parseInt(a),b)},a.verto.conf.prototype.sendChat=function(a,b){var c=this;c.verto.rpcClient.call("verto.broadcast",{eventChannel:c.params.laData.chatChannel,data:{action:"send",message:a,type:b}})}}function f(b,c){return!(c!=a.verto.enum.state.purge&&!a.verto.enum.states[b.name][c.name])}function g(b){for(var c in a.verto.audioOutDevices){var d=a.verto.audioOutDevices[c];if(d.id===b)return d.label}return b}var h="undefined"!=typeof window.crypto&&"undefined"!=typeof window.crypto.getRandomValues?function(){var a=new Uint16Array(8);window.crypto.getRandomValues(a);var b=function(a){for(var b=a.toString(16);b.length<4;)b="0"+b;return b};return b(a[0])+b(a[1])+"-"+b(a[2])+"-"+b(a[3])+"-"+b(a[4])+"-"+b(a[5])+b(a[6])+b(a[7])}:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})};a.verto=function(b,c){var d=this;a.verto.saved.push(d),d.options=a.extend({login:null,passwd:null,socketUrl:null,tag:null,localTag:null,videoParams:{},audioParams:{},loginParams:{},deviceParams:{onResCheck:null},userVariables:{},iceServers:!1,ringSleep:6e3,sessid:null},b),d.options.deviceParams.useCamera&&a.FSRTC.getValidRes(d.options.deviceParams.useCamera,d.options.deviceParams.onResCheck),d.options.deviceParams.useMic||(d.options.deviceParams.useMic="any"),d.options.deviceParams.useSpeak||(d.options.deviceParams.useSpeak="any"),d.options.sessid?d.sessid=d.options.sessid:(d.sessid=localStorage.getItem("verto_session_uuid")||h(),localStorage.setItem("verto_session_uuid",d.sessid)),d.dialogs={},d.callbacks=c||{},d.eventSUBS={},d.rpcClient=new a.JsonRpcClient({login:d.options.login,passwd:d.options.passwd,socketUrl:d.options.socketUrl,loginParams:d.options.loginParams,userVariables:d.options.userVariables,sessid:d.sessid,onmessage:function(a){return d.handleMessage(a.eventData)},onWSConnect:function(a){a.call("login",{})},onWSLogin:function(a){d.callbacks.onWSLogin&&d.callbacks.onWSLogin(d,a)},onWSClose:function(a){d.callbacks.onWSClose&&d.callbacks.onWSClose(d,a),d.purge()}});var e=d.options.tag;"function"==typeof e&&(e=e()),d.options.ringFile&&d.options.tag&&(d.ringer=a("#"+e)),d.rpcClient.call("login",{})},a.verto.prototype.deviceParams=function(b){var c=this;for(var d in b)c.options.deviceParams[d]=b[d];b.useCamera&&a.FSRTC.getValidRes(c.options.deviceParams.useCamera,b?b.onResCheck:void 0)},a.verto.prototype.videoParams=function(a){var b=this;for(var c in a)b.options.videoParams[c]=a[c]},a.verto.prototype.iceServers=function(a){var b=this;b.options.iceServers=a},a.verto.prototype.loginData=function(a){var b=this;b.options.login=a.login,b.options.passwd=a.passwd,b.rpcClient.loginData(a)},a.verto.prototype.logout=function(a){var b=this;b.rpcClient.closeSocket(),b.callbacks.onWSClose&&b.callbacks.onWSClose(b,!1),b.purge()},a.verto.prototype.login=function(a){var b=this;b.logout(),b.rpcClient.call("login",{})},a.verto.prototype.message=function(a){var b=this,c=0;return a.to||(console.error("Missing To"),c++),a.body||(console.error("Missing Body"),c++),!c&&(b.sendMethod("verto.info",{msg:a}),!0)},a.verto.prototype.processReply=function(a,d,e){var f,g=this;switch(a){case"verto.subscribe":for(f in e.unauthorizedChannels)b(g,e.unauthorizedChannels[f]);for(f in e.subscribedChannels)c(g,e.subscribedChannels[f]);break;case"verto.unsubscribe":}},a.verto.prototype.sendMethod=function(a,b){var c=this;c.rpcClient.call(a,b,function(b){c.processReply(a,!0,b)},function(b){c.processReply(a,!1,b)})};var i=1;a.verto.prototype.subscribe=function(a,b){var c=this,e=[],f=[],g=b||{};if("string"==typeof a)e.push(d(c,a,f,g));else for(var h in a)e.push(d(c,a,f,g));return f.length&&c.sendMethod("verto.subscribe",{eventChannel:1==f.length?f[0]:f,subParams:g.subParams}),e},a.verto.prototype.unsubscribe=function(a){var b,c=this;if(a){var d,e={},f=[];if("string"==typeof a)delete c.eventSUBS[a],e[a]++;else for(b in a)if("string"==typeof a[b])d=a[b],delete c.eventSUBS[d],e[d]++;else{var g=[];d=a[b].eventChannel;for(var h in c.eventSUBS[d])c.eventSUBS[d][h].serno==a[b].serno||g.push(c.eventSUBS[d][h]);c.eventSUBS[d]=g,0===c.eventSUBS[d].length&&(delete c.eventSUBS[d],e[d]++)}for(var i in e)console.log("Sending Unsubscribe for: ",i),f.push(i);f.length&&c.sendMethod("verto.unsubscribe",{eventChannel:1==f.length?f[0]:f})}else for(b in c.eventSUBS)c.eventSUBS[b]&&c.unsubscribe(c.eventSUBS[b])},a.verto.prototype.broadcast=function(a,b){var c=this,d={eventChannel:a,data:{}};for(var e in b)d.data[e]=b[e];c.sendMethod("verto.broadcast",d)},a.verto.prototype.purge=function(b){var c,d=this,e=0;for(c in d.dialogs)e||console.log("purging dialogs"),e++,d.dialogs[c].setState(a.verto.enum.state.purge);for(c in d.eventSUBS)d.eventSUBS[c]&&(console.log("purging subscription: "+c),delete d.eventSUBS[c])},a.verto.prototype.hangup=function(a){var b=this;if(a){var c=b.dialogs[a];c&&c.hangup()}else for(var d in b.dialogs)b.dialogs[d].hangup()},a.verto.prototype.newCall=function(b,c){var d=this;if(!d.rpcClient.socketReady())return void console.error("Not Connected...");var e=new a.verto.dialog(a.verto.enum.direction.outbound,this,b);return e.invite(),c&&(e.callbacks=c),e},a.verto.prototype.handleMessage=function(b){var c=this;if(!b||!b.method)return void console.error("Invalid Data",b);if(b.params.callID){var d=c.dialogs[b.params.callID];if("verto.attach"===b.method&&d&&(delete d.verto.dialogs[d.callID],d.rtc.stop(),d=null),d)switch(b.method){case"verto.bye":d.hangup(b.params);break;case"verto.answer":d.handleAnswer(b.params);break;case"verto.media":d.handleMedia(b.params);break;case"verto.display":d.handleDisplay(b.params);break;case"verto.info":d.handleInfo(b.params);break;default:console.debug("INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED",d,b.method)}else switch(b.method){case"verto.attach":b.params.attach=!0,b.params.sdp&&b.params.sdp.indexOf("m=video")>0&&(b.params.useVideo=!0),b.params.sdp&&b.params.sdp.indexOf("stereo=1")>0&&(b.params.useStereo=!0),d=new a.verto.dialog(a.verto.enum.direction.inbound,c,b.params),d.setState(a.verto.enum.state.recovering);break;case"verto.invite":b.params.sdp&&b.params.sdp.indexOf("m=video")>0&&(b.params.wantVideo=!0),b.params.sdp&&b.params.sdp.indexOf("stereo=1")>0&&(b.params.useStereo=!0),d=new a.verto.dialog(a.verto.enum.direction.inbound,c,b.params);break;default:console.debug("INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED")}return{method:b.method}}switch(b.method){case"verto.punt":c.purge(),c.logout();break;case"verto.event":var e=null,f=null;if(b.params&&(f=b.params.eventChannel),f&&(e=c.eventSUBS[f],e||(e=c.eventSUBS[f.split(".")[0]])),!e&&f&&f===c.sessid)c.callbacks.onMessage&&c.callbacks.onMessage(c,null,a.verto.enum.message.pvtEvent,b.params);else if(!e&&f&&c.dialogs[f])c.dialogs[f].sendMessage(a.verto.enum.message.pvtEvent,b.params);else if(e)for(var g in e){var h=e[g];h&&h.ready?h.handler?h.handler(c,b.params,h.userData):c.callbacks.onEvent?c.callbacks.onEvent(c,b.params,h.userData):console.log("EVENT:",b.params):console.error("invalid EVENT for "+f+" IGNORED")}else f||(f="UNDEFINED"),console.error("UNSUBBED or invalid EVENT "+f+" IGNORED");break;case"verto.info":c.callbacks.onMessage&&c.callbacks.onMessage(c,null,a.verto.enum.message.info,b.params.msg),console.debug("MESSAGE from: "+b.params.msg.from,b.params.msg.body);break;default:console.error("INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED",b.method)}};var j=function(a,b){for(var c=[],d=a.length,e=0;e<d;e++)a[e]!=b&&c.push(a[e]);return c},k=function(){var a=this,b={},c=[];a.reorder=function(a){c=a;var d=b;b={};for(var e=c.length,f=0;f<e;f++){var g=c[f];d[g]&&(b[g]=d[g],delete d[g])}d=void 0},a.clear=function(){b=void 0,c=void 0,b={},c=[]},a.add=function(a,d,e){var f=!1;if(!b[a])if(void 0===e||e<0||e>=c.length)c.push(a);else{for(var g=0,h=[],i=c.length,j=0;j<i;j++)g++==e&&h.push(a),h.push(c[j]);c=void 0,c=h,h=void 0,f=!0}return b[a]=d,f},a.del=function(a){var d=!1;return b[a]?(c=j(c,a),delete b[a],d=!0):console.error("can't del nonexistant key "+a),d},a.get=function(a){return b[a]},a.order=function(){return c},a.hash=function(){return b},a.indexOf=function(a){for(var b=c.length,d=0;d<b;d++)if(c[d]==a)return d},a.arrayLen=function(){return c.length},a.asArray=function(){for(var a=[],d=c.length,e=0;e<d;e++){var f=c[e];a.push(b[f])}return a},a.each=function(a){for(var d=c.length,e=0;e<d;e++)a(c[e],b[c[e]])},a.dump=function(b){var c="";return a.each(function(a,d){c+="name: "+a+" val: "+JSON.stringify(d)+(b?"<br>":"\n")}),c}};a.verto.liveArray=function(a,b,c,d){var e=this,f=0,g=null,h=d.userObj;k.call(e),e._add=e.add,e._del=e.del,e._reorder=e.reorder,e._clear=e.clear,e.context=b,e.name=c,e.user_obj=h,e.verto=a,e.broadcast=function(b,c){a.broadcast(b,c)},e.errs=0,e.clear=function(){e._clear(),f=0,e.onChange&&e.onChange(e,{action:"clear"})},e.checkSerno=function(a){return a<0||(f>0&&a!=f+1?(e.onErr&&e.onErr(e,{lastSerno:f,serno:a}),e.errs++,console.debug(e.errs),e.errs<3&&e.bootstrap(e.user_obj),!1):(f=a,!0))},e.reorder=function(a,b){e.checkSerno(a)&&(e._reorder(b),e.onChange&&e.onChange(e,{serno:a,action:"reorder"}))},e.init=function(a,b,c,d){null!==c&&void 0!==c||(c=a),e.checkSerno(a)&&e.onChange&&e.onChange(e,{serno:a,action:"init",index:d,key:c,data:b})},e.bootObj=function(a,b){if(e.checkSerno(a)){for(var c in b)e._add(b[c][0],b[c][1]);e.onChange&&e.onChange(e,{serno:a,action:"bootObj",data:b,redraw:!0})}},e.add=function(a,b,c,d){if(null!==c&&void 0!==c||(c=a),e.checkSerno(a)){var f=e._add(c,b,d);e.onChange&&e.onChange(e,{serno:a,action:"add",index:d,key:c,data:b,redraw:f})}},e.modify=function(a,b,c,d){null!==c&&void 0!==c||(c=a),e.checkSerno(a)&&(e._add(c,b,d),e.onChange&&e.onChange(e,{serno:a,action:"modify",key:c,data:b,index:d}))},e.del=function(a,b,c){if(null!==b&&void 0!==b||(b=a),e.checkSerno(a)){(null===c||c<0||void 0===c)&&(c=e.indexOf(b));var d=e._del(b);d&&e.onChange&&e.onChange(e,{serno:a,action:"del",key:b,index:c})}};var i=function(a,b,c){var d=b.data;if(d.name==c.name)switch(d.action){case"init":c.init(d.wireSerno,d.data,d.hashKey,d.arrIndex);break;case"bootObj":c.bootObj(d.wireSerno,d.data);break;case"add":c.add(d.wireSerno,d.data,d.hashKey,d.arrIndex);break;case"modify":d.arrIndex||d.hashKey?c.modify(d.wireSerno,d.data,d.hashKey,d.arrIndex):console.error("Invalid Packet",d);break;case"del":d.arrIndex||d.hashKey?c.del(d.wireSerno,d.hashKey,d.arrIndex):console.error("Invalid Packet",d);break;case"clear":c.clear();break;case"reorder":c.reorder(d.wireSerno,d.order);break;default:c.checkSerno(d.wireSerno)&&c.onChange&&c.onChange(c,{serno:d.wireSerno,action:d.action,data:d.data})}};e.context&&(g=e.verto.subscribe(e.context,{handler:i,userData:e,subParams:d.subParams})),e.destroy=function(){e._clear(),e.verto.unsubscribe(g)},e.sendCommand=function(a,b){var c=e;c.broadcast(c.context,{liveArray:{command:a,context:c.context,name:c.name,obj:b}})},e.bootstrap=function(a){e.sendCommand("bootstrap",a)},e.changepage=function(a){var b=e;b.clear(),b.broadcast(b.context,{liveArray:{command:"changepage",context:e.context,name:e.name,obj:a}})},e.heartbeat=function(a){var b=e,c=function(){b.heartbeat.call(b,a)};b.broadcast(b.context,{liveArray:{command:"heartbeat",context:b.context,name:b.name,obj:a}}),b.hb_pid=setTimeout(c,3e4)},e.bootstrap(e.user_obj)},a.verto.liveTable=function(b,c,d,e,f){function g(b){if("string"==typeof b[4]&&b[4].indexOf("{")>-1){var c=a.parseJSON(b[4]);b[4]=c.oldStatus,b[5]=null}return b}function h(a){var b=a.asArray();for(var c in b)b[c]=g(b[c]);return b}var i,j=new a.verto.liveArray(b,c,d,{subParams:f.subParams}),k=this;k.liveArray=j,k.dataTable=i,k.verto=b,k.destroy=function(){i&&i.fnDestroy(),j&&j.destroy(),i=null,j=null},j.onErr=function(a,b){console.error("Error: ",a,b)},j.onChange=function(a,b){var c=0,d=0;if(!i){if(!f.aoColumns){if("init"!=b.action)return;f.aoColumns=[];for(var k in b.data)f.aoColumns.push({sTitle:b.data[k]})}i=e.dataTable(f)}if(i&&("del"==b.action||"modify"==b.action)&&(c=b.index,void 0===c&&b.key&&(c=j.indexOf(b.key)),void 0===c))return void console.error("INVALID PACKET Missing INDEX\n",b);f.onChange&&f.onChange(a,b);try{switch(b.action){case"bootObj":if(!b.data)return void console.error("missing data");i.fnClearTable(),i.fnAddData(h(a)),i.fnAdjustColumnSizing();break;case"add":if(!b.data)return void console.error("missing data");b.redraw>-1?(i.fnClearTable(),i.fnAddData(h(a))):i.fnAddData(g(b.data)),i.fnAdjustColumnSizing();break;case"modify":if(!b.data)return;i.fnUpdate(g(b.data),c),i.fnAdjustColumnSizing();break;case"del":i.fnDeleteRow(c),i.fnAdjustColumnSizing();break;case"clear":i.fnClearTable();break;case"reorder":i.fnClearTable(),i.fnAddData(h(a));break;case"hide":e.hide();break;case"show":e.show()}}catch(a){console.error("ERROR: "+a),d++}d?(a.errs++,a.errs<3&&a.bootstrap(a.user_obj)):a.errs=0},j.onChange(j,{action:"init"})};var l=1;a.verto.conf=function(b,c){var d=this;d.params=a.extend({dialog:null,hasVid:!1,laData:null,onBroadcast:null,onLaChange:null,onLaRow:null},c),d.verto=b,d.serno=l++,e(),b.subscribe(d.params.laData.modChannel,{
handler:function(a,c){d.params.onBroadcast&&d.params.onBroadcast(b,d,c.data)}}),b.subscribe(d.params.laData.chatChannel,{handler:function(a,b){"function"==typeof d.params.chatCallback&&d.params.chatCallback(a,b)}})},a.verto.conf.prototype.modCommand=function(a,b,c){var d=this;d.verto.rpcClient.call("verto.broadcast",{eventChannel:d.params.laData.modChannel,data:{application:"conf-control",command:a,id:b,value:c}})},a.verto.conf.prototype.destroy=function(){var a=this;a.destroyed=!0,a.params.onBroadcast(a.verto,a,"destroy"),a.params.laData.modChannel&&a.verto.unsubscribe(a.params.laData.modChannel),a.params.laData.chatChannel&&a.verto.unsubscribe(a.params.laData.chatChannel)},a.verto.modfuncs={},a.verto.confMan=function(b,c){function d(b){var c="play_"+f.serno,d="stop_"+f.serno,e="recording_"+f.serno,g="snapshot_"+f.serno,h="recording_stop"+f.serno,i="confman_"+f.serno,j="<div id='"+i+"'><br><button class='ctlbtn' id='"+c+"'>Play</button><button class='ctlbtn' id='"+d+"'>Stop</button><button class='ctlbtn' id='"+e+"'>Record</button><button class='ctlbtn' id='"+h+"'>Record Stop</button>"+(f.params.hasVid?"<button class='ctlbtn' id='"+g+"'>PNG Snapshot</button>":"")+"<br><br></div>";if(b.html(j),a.verto.modfuncs.change_video_layout=function(b,c){var d=a("#"+b+" option:selected").text();"none"!==d&&f.modCommand("vid-layout",null,[d,c])},f.params.hasVid){for(var k=0;k<f.canvasCount;k++){var l="confman_vid_layout_"+k+"_"+f.serno,m="confman_vl_select_"+k+"_"+f.serno,n="<div id='"+l+"'><br><b>Video Layout Canvas "+(k+1)+"</b> <select onChange='$.verto.modfuncs.change_video_layout(\""+l+'", "'+(k+1)+"\")' id='"+m+"'></select> <br><br></div>";b.append(n)}a("#"+g).click(function(){var a=prompt("Please enter file name","");a&&f.modCommand("vid-write-png",null,a)})}a("#"+c).click(function(){var a=prompt("Please enter file name","");a&&f.modCommand("play",null,a)}),a("#"+d).click(function(){f.modCommand("stop",null,"all")}),a("#"+e).click(function(){var a=prompt("Please enter file name","");a&&f.modCommand("recording",null,["start",a])}),a("#"+h).click(function(){f.modCommand("recording",null,["stop","all"])})}function e(b,c){var d=parseInt(c),e="kick_"+d,g="canvas_in_next_"+d,h="canvas_in_prev_"+d,i="canvas_out_next_"+d,j="canvas_out_prev_"+d,k="canvas_in_set_"+d,l="canvas_out_set_"+d,m="layer_set_"+d,n="layer_next_"+d,o="layer_prev_"+d,p="tmute_"+d,q="tvmute_"+d,r="vbanner_"+d,s="tvpresenter_"+d,t="tvfloor_"+d,u="box_"+d,v="gain_in_up"+d,w="gain_in_dn"+d,x="vol_in_up"+d,y="vol_in_dn"+d,z="transfer"+d,A="<div id='"+u+"'>";return A+="<b>General Controls</b><hr noshade>",A+="<button class='ctlbtn' id='"+e+"'>Kick</button><button class='ctlbtn' id='"+p+"'>Mute</button><button class='ctlbtn' id='"+v+"'>Gain -</button><button class='ctlbtn' id='"+w+"'>Gain +</button><button class='ctlbtn' id='"+y+"'>Vol -</button><button class='ctlbtn' id='"+x+"'>Vol +</button><button class='ctlbtn' id='"+z+"'>Transfer</button>",f.params.hasVid&&(A+="<br><br><b>Video Controls</b><hr noshade>",A+="<button class='ctlbtn' id='"+q+"'>VMute</button><button class='ctlbtn' id='"+s+"'>Presenter</button><button class='ctlbtn' id='"+t+"'>Vid Floor</button><button class='ctlbtn' id='"+r+"'>Banner</button>",f.canvasCount>1&&(A+="<br><br><b>Canvas Controls</b><hr noshade><button class='ctlbtn' id='"+k+"'>Set Input Canvas</button><button class='ctlbtn' id='"+h+"'>Prev Input Canvas</button><button class='ctlbtn' id='"+g+"'>Next Input Canvas</button><br><button class='ctlbtn' id='"+l+"'>Set Watching Canvas</button><button class='ctlbtn' id='"+j+"'>Prev Watching Canvas</button><button class='ctlbtn' id='"+i+"'>Next Watching Canvas</button>"),A+="<br><button class='ctlbtn' id='"+m+"'>Set Layer</button><button class='ctlbtn' id='"+o+"'>Prev Layer</button><button class='ctlbtn' id='"+n+"'>Next Layer</button></div>"),b.html(A),b.data("mouse")||a("#"+u).hide(),b.mouseover(function(c){b.data({mouse:!0}),a("#"+u).show()}),b.mouseout(function(c){b.data({mouse:!1}),a("#"+u).hide()}),a("#"+z).click(function(){var a=prompt("Enter Extension");a&&f.modCommand("transfer",d,a)}),a("#"+e).click(function(){f.modCommand("kick",d)}),a("#"+m).click(function(){var a=prompt("Please enter layer ID","");a&&f.modCommand("vid-layer",d,a)}),a("#"+n).click(function(){f.modCommand("vid-layer",d,"next")}),a("#"+o).click(function(){f.modCommand("vid-layer",d,"prev")}),a("#"+k).click(function(){var a=prompt("Please enter canvas ID","");a&&f.modCommand("vid-canvas",d,a)}),a("#"+l).click(function(){var a=prompt("Please enter canvas ID","");a&&f.modCommand("vid-watching-canvas",d,a)}),a("#"+g).click(function(){f.modCommand("vid-canvas",d,"next")}),a("#"+h).click(function(){f.modCommand("vid-canvas",d,"prev")}),a("#"+i).click(function(){f.modCommand("vid-watching-canvas",d,"next")}),a("#"+j).click(function(){f.modCommand("vid-watching-canvas",d,"prev")}),a("#"+p).click(function(){f.modCommand("tmute",d)}),f.params.hasVid&&(a("#"+q).click(function(){f.modCommand("tvmute",d)}),a("#"+s).click(function(){f.modCommand("vid-res-id",d,"presenter")}),a("#"+t).click(function(){f.modCommand("vid-floor",d,"force")}),a("#"+r).click(function(){var a=prompt("Please enter text","");a&&f.modCommand("vid-banner",d,escape(a))})),a("#"+v).click(function(){f.modCommand("volume_in",d,"up")}),a("#"+w).click(function(){f.modCommand("volume_in",d,"down")}),a("#"+x).click(function(){f.modCommand("volume_out",d,"up")}),a("#"+y).click(function(){f.modCommand("volume_out",d,"down")}),A}var f=this;f.params=a.extend({tableID:null,statusID:null,mainModID:null,dialog:null,hasVid:!1,laData:null,onBroadcast:null,onLaChange:null,onLaRow:null},c),f.verto=b,f.serno=l++,f.canvasCount=f.params.laData.canvasCount;var g="",h=0;b.subscribe(f.params.laData.chatChannel,{handler:function(a,b){"function"==typeof f.params.chatCallback&&f.params.chatCallback(a,b)}}),"moderator"===f.params.laData.role&&(g="Action",h=600,f.params.mainModID?(d(a(f.params.mainModID)),a(f.params.displayID).html("Moderator Controls Ready<br><br>")):a(f.params.mainModID).html(""),b.subscribe(f.params.laData.modChannel,{handler:function(c,d){if(f.params.onBroadcast&&f.params.onBroadcast(b,f,d.data),"list-videoLayouts"===d.data["conf-command"])for(var e=0;e<f.canvasCount;e++){var g,h="#confman_vl_select_"+e+"_"+f.serno,i="#confman_vid_layout_"+e+"_"+f.serno,j=0;if(a(h).selectmenu({}),a(h).selectmenu("enable"),a(h).empty(),a(h).append(new Option("Choose a Layout","none")),d.data.responseData){var k=[];for(var l in d.data.responseData)k.push(d.data.responseData[l].name);g=k.sort(function(a,b){var c="group:"==a.substring(0,6),d="group:"==b.substring(0,6);return(c||d)&&c!=d?c?-1:1:a==b?0:a>b?1:-1});for(var l in g)a(h).append(new Option(g[l],g[l])),j++}j?a(h).selectmenu("refresh",!0):a(i).hide()}else!f.destroyed&&f.params.displayID&&(a(f.params.displayID).html(d.data.response+"<br><br>"),f.lastTimeout&&(clearTimeout(f.lastTimeout),f.lastTimeout=0),f.lastTimeout=setTimeout(function(){a(f.params.displayID).html(f.destroyed?"":"Moderator Controls Ready<br><br>")},4e3))}}),f.params.hasVid&&f.modCommand("list-videoLayouts",null,null));var i=null;"moderator"===f.params.laData.role&&(i=function(c,d,g,h){if(!d[5]){var i=a("td:eq(5)",c);e(i,d),f.params.onLaRow&&f.params.onLaRow(b,f,i,d)}}),f.lt=new a.verto.liveTable(b,f.params.laData.laChannel,f.params.laData.laName,a(f.params.tableID),{subParams:{callID:f.params.dialog?f.params.dialog.callID:null},onChange:function(c,d){a(f.params.statusID).text("Conference Members:  ("+c.arrayLen()+" Total)"),f.params.onLaChange&&f.params.onLaChange(b,f,a.verto.enum.confEvent.laChange,c,d)},aaData:[],aoColumns:[{sTitle:"ID",sWidth:"50"},{sTitle:"Number",sWidth:"250"},{sTitle:"Name",sWidth:"250"},{sTitle:"Codec",sWidth:"100"},{sTitle:"Status",sWidth:f.params.hasVid?"200px":"150px"},{sTitle:g,sWidth:h}],bAutoWidth:!0,bDestroy:!0,bSort:!1,bInfo:!1,bFilter:!1,bLengthChange:!1,bPaginate:!1,iDisplayLength:1400,oLanguage:{sEmptyTable:"The Conference is Empty....."},fnRowCallback:i})},a.verto.confMan.prototype.modCommand=function(a,b,c){var d=this;d.verto.rpcClient.call("verto.broadcast",{eventChannel:d.params.laData.modChannel,data:{application:"conf-control",command:a,id:b,value:c}})},a.verto.confMan.prototype.sendChat=function(a,b){var c=this;c.verto.rpcClient.call("verto.broadcast",{eventChannel:c.params.laData.chatChannel,data:{action:"send",message:a,type:b}})},a.verto.confMan.prototype.destroy=function(){var b=this;b.destroyed=!0,b.lt&&b.lt.destroy(),b.params.laData.chatChannel&&b.verto.unsubscribe(b.params.laData.chatChannel),b.params.laData.modChannel&&b.verto.unsubscribe(b.params.laData.modChannel),b.params.mainModID&&a(b.params.mainModID).html("")},a.verto.dialog=function(b,c,d){var e=this;e.params=a.extend({useVideo:c.options.useVideo,useStereo:c.options.useStereo,screenShare:!1,useCamera:c.options.deviceParams.useCamera,useMic:c.options.deviceParams.useMic,useSpeak:c.options.deviceParams.useSpeak,tag:c.options.tag,localTag:c.options.localTag,login:c.options.login,videoParams:c.options.videoParams},d),e.verto=c,e.direction=b,e.lastState=null,e.state=e.lastState=a.verto.enum.state.new,e.callbacks=c.callbacks,e.answered=!1,e.attach=d.attach||!1,e.screenShare=d.screenShare||!1,e.useCamera=e.params.useCamera,e.useMic=e.params.useMic,e.useSpeak=e.params.useSpeak,e.params.callID?e.callID=e.params.callID:e.callID=e.params.callID=h(),"function"==typeof e.params.tag&&(e.params.tag=e.params.tag()),e.params.tag&&(e.audioStream=document.getElementById(e.params.tag),e.params.useVideo&&(e.videoStream=e.audioStream)),e.params.localTag&&(e.localVideo=document.getElementById(e.params.localTag)),e.verto.dialogs[e.callID]=e;var f={};e.direction==a.verto.enum.direction.inbound?("outbound"===e.params.display_direction?(e.params.remote_caller_id_name=e.params.caller_id_name,e.params.remote_caller_id_number=e.params.caller_id_number):(e.params.remote_caller_id_name=e.params.callee_id_name,e.params.remote_caller_id_number=e.params.callee_id_number),e.params.remote_caller_id_name||(e.params.remote_caller_id_name="Nobody"),e.params.remote_caller_id_number||(e.params.remote_caller_id_number="UNKNOWN"),f.onMessage=function(a,b){console.debug(b)},f.onAnswerSDP=function(a,b){console.error("answer sdp",b)}):(e.params.remote_caller_id_name="Outbound Call",e.params.remote_caller_id_number=e.params.destination_number),f.onICESDP=function(b){return console.log("RECV "+b.type+" SDP",b.mediaData.SDP),e.state==a.verto.enum.state.requesting||e.state==a.verto.enum.state.answering||e.state==a.verto.enum.state.active?void location.reload():void("offer"==b.type?e.state==a.verto.enum.state.active?(e.setState(a.verto.enum.state.requesting),e.sendMethod("verto.attach",{sdp:b.mediaData.SDP})):(e.setState(a.verto.enum.state.requesting),e.sendMethod("verto.invite",{sdp:b.mediaData.SDP})):(e.setState(a.verto.enum.state.answering),e.sendMethod(e.attach?"verto.attach":"verto.answer",{sdp:e.rtc.mediaData.SDP})))},f.onICE=function(a){if("offer"==a.type)return void console.log("offer",a.mediaData.candidate)},f.onStream=function(a,b){e.verto.options.permissionCallback&&"function"==typeof e.verto.options.permissionCallback.onGranted&&e.verto.options.permissionCallback.onGranted(b),console.log("stream started")},f.onError=function(a){e.verto.options.permissionCallback&&"function"==typeof e.verto.options.permissionCallback.onDenied&&e.verto.options.permissionCallback.onDenied(),console.error("ERROR:",a),e.hangup({cause:"Device or Permission Error"})},console.log("----------------------"),console.log(e),console.log("----------------------"),e.rtc=new a.FSRTC({callbacks:f,localVideo:e.screenShare?null:e.localVideo,useVideo:e.params.useVideo?e.videoStream:null,useAudio:e.audioStream,useStereo:e.params.useStereo,videoParams:e.params.videoParams,audioParams:c.options.audioParams,iceServers:c.options.iceServers,screenShare:e.screenShare,useCamera:e.useCamera,useMic:e.useMic,useSpeak:e.useSpeak}),e.rtc.verto=e.verto,e.direction==a.verto.enum.direction.inbound&&(e.attach?e.answer():e.ring())},a.verto.dialog.prototype.invite=function(){var a=this;a.rtc.call()},a.verto.dialog.prototype.sendMethod=function(a,b){var c=this;b.dialogParams={};for(var d in c.params)"sdp"==d&&"verto.invite"!=a&&"verto.attach"!=a||b.noDialogParams&&"callID"!=d||(b.dialogParams[d]=c.params[d]);delete b.noDialogParams,c.verto.rpcClient.call(a,b,function(b){c.processReply(a,!0,b)},function(b){c.processReply(a,!1,b)})},a.verto.dialog.prototype.setAudioPlaybackDevice=function(a,b,c){var d=this,e=d.audioStream;if("undefined"!=typeof e.sinkId){var f=g(a);console.info("Dialog: "+d.callID+" Setting speaker:",e,f),e.setSinkId(a).then(function(){console.log("Dialog: "+d.callID+" Success, audio output device attached: "+a),b&&b(!0,f,c)}).catch(function(a){var e=a;"SecurityError"===a.name&&(e="Dialog: "+d.callID+" You need to use HTTPS for selecting audio output device: "+a),b&&b(!1,null,c),console.error(e)})}else console.warn("Dialog: "+d.callID+" Browser does not support output device selection."),b&&b(!1,null,c)},a.verto.dialog.prototype.setState=function(b){var c=this;if(c.state==a.verto.enum.state.ringing&&c.stopRinging(),c.state==b||!f(c.state,b))return console.error("Dialog "+c.callID+": INVALID state change from "+c.state.name+" to "+b.name),c.hangup(),!1;switch(console.log("Dialog "+c.callID+": state change from "+c.state.name+" to "+b.name),c.lastState=c.state,c.state=b,c.causeCode||(c.causeCode=16),c.cause||(c.cause="NORMAL CLEARING"),c.callbacks.onDialogState&&c.callbacks.onDialogState(this),c.state){case a.verto.enum.state.early:case a.verto.enum.state.active:var d=c.useSpeak;console.info("Using Speaker: ",d),d&&"any"!==d&&"none"!==d&&setTimeout(function(){c.setAudioPlaybackDevice(d)},500);break;case a.verto.enum.state.trying:setTimeout(function(){c.state==a.verto.enum.state.trying&&c.setState(a.verto.enum.state.hangup)},3e4);break;case a.verto.enum.state.purge:c.setState(a.verto.enum.state.destroy);break;case a.verto.enum.state.hangup:c.lastState.val>a.verto.enum.state.requesting.val&&c.lastState.val<a.verto.enum.state.hangup.val&&c.sendMethod("verto.bye",{}),c.setState(a.verto.enum.state.destroy);break;case a.verto.enum.state.destroy:"function"==typeof c.verto.options.tag&&a("#"+c.params.tag).remove(),delete c.verto.dialogs[c.callID],c.params.screenShare?c.rtc.stopPeer():c.rtc.stop()}return!0},a.verto.dialog.prototype.processReply=function(b,c,d){var e=this;switch(b){case"verto.answer":case"verto.attach":c?e.setState(a.verto.enum.state.active):e.hangup();break;case"verto.invite":c?e.setState(a.verto.enum.state.trying):e.setState(a.verto.enum.state.destroy);break;case"verto.bye":e.hangup();break;case"verto.modify":d.holdState&&("held"==d.holdState?e.state!=a.verto.enum.state.held&&e.setState(a.verto.enum.state.held):"active"==d.holdState&&e.state!=a.verto.enum.state.active&&e.setState(a.verto.enum.state.active))}},a.verto.dialog.prototype.hangup=function(b){var c=this;b&&(b.causeCode&&(c.causeCode=b.causeCode),b.cause&&(c.cause=b.cause)),c.state.val>=a.verto.enum.state.new.val&&c.state.val<a.verto.enum.state.hangup.val?c.setState(a.verto.enum.state.hangup):c.state.val<a.verto.enum.state.destroy&&c.setState(a.verto.enum.state.destroy)},a.verto.dialog.prototype.stopRinging=function(){var a=this;a.verto.ringer&&a.verto.ringer.stop()},a.verto.dialog.prototype.indicateRing=function(){var b=this;b.verto.ringer&&(b.verto.ringer.attr("src",b.verto.options.ringFile)[0].play(),setTimeout(function(){b.stopRinging(),b.state==a.verto.enum.state.ringing&&b.indicateRing()},b.verto.options.ringSleep))},a.verto.dialog.prototype.ring=function(){var b=this;b.setState(a.verto.enum.state.ringing),b.indicateRing()},a.verto.dialog.prototype.useVideo=function(a){var b=this;b.params.useVideo=a,a?b.videoStream=b.audioStream:b.videoStream=null,b.rtc.useVideo(b.videoStream,b.localVideo)},a.verto.dialog.prototype.setMute=function(a){var b=this;return b.rtc.setMute(a)},a.verto.dialog.prototype.getMute=function(){var a=this;return a.rtc.getMute()},a.verto.dialog.prototype.setVideoMute=function(a){var b=this;return b.rtc.setVideoMute(a)},a.verto.dialog.prototype.getVideoMute=function(){var a=this;return a.rtc.getVideoMute()},a.verto.dialog.prototype.useStereo=function(a){var b=this;b.params.useStereo=a,b.rtc.useStereo(a)},a.verto.dialog.prototype.dtmf=function(a){var b=this;a&&b.sendMethod("verto.info",{dtmf:a})},a.verto.dialog.prototype.rtt=function(a){var b=this,c={};return!!a&&(c.code=a.code,c.chars=a.chars,void((c.chars||c.code)&&b.sendMethod("verto.info",{txt:a,noDialogParams:!0})))},a.verto.dialog.prototype.transfer=function(a,b){var c=this;a&&c.sendMethod("verto.modify",{action:"transfer",destination:a,params:b})},a.verto.dialog.prototype.hold=function(a){var b=this;b.sendMethod("verto.modify",{action:"hold",params:a})},a.verto.dialog.prototype.unhold=function(a){var b=this;b.sendMethod("verto.modify",{action:"unhold",params:a})},a.verto.dialog.prototype.toggleHold=function(a){var b=this;b.sendMethod("verto.modify",{action:"toggleHold",params:a})},a.verto.dialog.prototype.message=function(a){var b=this,c=0;return a.from=b.params.login,a.to||(console.error("Missing To"),c++),a.body||(console.error("Missing Body"),c++),!c&&(b.sendMethod("verto.info",{msg:a}),!0)},a.verto.dialog.prototype.answer=function(a){var b=this;b.answered||(a||(a={}),a.sdp=b.params.sdp,a&&(a.useVideo&&b.useVideo(!0),b.params.callee_id_name=a.callee_id_name,b.params.callee_id_number=a.callee_id_number,a.useCamera&&(b.useCamera=a.useCamera),a.useMic&&(b.useMic=a.useMic),a.useSpeak&&(b.useSpeak=a.useSpeak)),b.rtc.createAnswer(a),b.answered=!0)},a.verto.dialog.prototype.handleAnswer=function(b){var c=this;c.gotAnswer=!0,c.state.val>=a.verto.enum.state.active.val||(c.state.val>=a.verto.enum.state.early.val?c.setState(a.verto.enum.state.active):c.gotEarly?console.log("Dialog "+c.callID+" Got answer while still establishing early media, delaying..."):(console.log("Dialog "+c.callID+" Answering Channel"),c.rtc.answer(b.sdp,function(){c.setState(a.verto.enum.state.active)},function(a){console.error(a),c.hangup()}),console.log("Dialog "+c.callID+"ANSWER SDP",b.sdp)))},a.verto.dialog.prototype.cidString=function(a){var b=this,c=b.params.remote_caller_id_name+(a?" &lt;":" <")+b.params.remote_caller_id_number+(a?"&gt;":">");return c},a.verto.dialog.prototype.sendMessage=function(a,b){var c=this;c.callbacks.onMessage&&c.callbacks.onMessage(c.verto,c,a,b)},a.verto.dialog.prototype.handleInfo=function(b){var c=this;c.sendMessage(a.verto.enum.message.info,b)},a.verto.dialog.prototype.handleDisplay=function(b){var c=this;b.display_name&&(c.params.remote_caller_id_name=b.display_name),b.display_number&&(c.params.remote_caller_id_number=b.display_number),c.sendMessage(a.verto.enum.message.display,{})},a.verto.dialog.prototype.handleMedia=function(b){var c=this;c.state.val>=a.verto.enum.state.early.val||(c.gotEarly=!0,c.rtc.answer(b.sdp,function(){console.log("Dialog "+c.callID+"Establishing early media"),c.setState(a.verto.enum.state.early),c.gotAnswer&&(console.log("Dialog "+c.callID+"Answering Channel"),c.setState(a.verto.enum.state.active))},function(a){console.error(a),c.hangup()}),console.log("Dialog "+c.callID+"EARLY SDP",b.sdp))},a.verto.ENUM=function(a){var b=0,c={};return a.split(" ").map(function(a){c[a]={name:a,val:b++}}),Object.freeze(c)},a.verto.enum={},a.verto.enum.states=Object.freeze({new:{requesting:1,recovering:1,ringing:1,destroy:1,answering:1,hangup:1},requesting:{trying:1,hangup:1,active:1},recovering:{answering:1,hangup:1},trying:{active:1,early:1,hangup:1},ringing:{answering:1,hangup:1},answering:{active:1,hangup:1},active:{answering:1,requesting:1,hangup:1,held:1},held:{hangup:1,active:1},early:{hangup:1,active:1},hangup:{destroy:1},destroy:{},purge:{destroy:1}}),a.verto.enum.state=a.verto.ENUM("new requesting trying recovering ringing answering early active held hangup destroy purge"),a.verto.enum.direction=a.verto.ENUM("inbound outbound"),a.verto.enum.message=a.verto.ENUM("display info pvtEvent"),a.verto.enum=Object.freeze(a.verto.enum),a.verto.saved=[],a.verto.unloadJobs=[],a(window).bind("beforeunload",function(){for(var b in a.verto.unloadJobs)a.verto.unloadJobs[b]();if(a.verto.haltClosure)return a.verto.haltClosure();for(var c in a.verto.saved){var d=a.verto.saved[c];d&&(d.purge(),d.logout())}return a.verto.warnOnUnload}),a.verto.videoDevices=[],a.verto.audioInDevices=[],a.verto.audioOutDevices=[];var m=function(b){console.info("enumerating devices");var c=[],d=[],e=[];if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||!MediaStreamTrack.getSources){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return void console.log("enumerateDevices() not supported.");navigator.mediaDevices.enumerateDevices().then(function(f){f.forEach(function(a){console.log(a),console.log(a.kind+": "+a.label+" id = "+a.deviceId),"videoinput"===a.kind?e.push({id:a.deviceId,kind:"video",label:a.label}):"audioinput"===a.kind?c.push({id:a.deviceId,kind:"audio_in",label:a.label}):"audiooutput"===a.kind&&d.push({id:a.deviceId,kind:"audio_out",label:a.label})}),a.verto.videoDevices=e,a.verto.audioInDevices=c,a.verto.audioOutDevices=d,console.info("Audio IN Devices",a.verto.audioInDevices),console.info("Audio Out Devices",a.verto.audioOutDevices),console.info("Video Devices",a.verto.videoDevices),b(!0)}).catch(function(a){console.log(" Device Enumeration ERROR: "+a.name+": "+a.message),b(!1)})}else MediaStreamTrack.getSources(function(d){for(var f=0;f<d.length;f++)"video"==d[f].kind?e.push(d[f]):c.push(d[f]);a.verto.videoDevices=e,a.verto.audioInDevices=c,console.info("Audio Devices",a.verto.audioInDevices),console.info("Video Devices",a.verto.videoDevices),b(!0)})};a.verto.refreshDevices=function(a){m(a)},a.verto.init=function(b,c){b||(b={}),b.skipPermCheck||b.skipDeviceCheck?b.skipPermCheck&&!b.skipDeviceCheck?m(c):!b.skipPermCheck&&b.skipDeviceCheck?a.FSRTC.checkPerms(function(a){c(a)},!0,!0):c(null):a.FSRTC.checkPerms(function(a){m(c)},!0,!0)},a.verto.genUUID=function(){return h()}}(jQuery);